class Value{constructor(v,loc,value=null){if(!Array.isArray(v))throw new RuntimeError(loc.first_line,"Valueの引数は配列でなければなりません:"+constructor_name(this)+":"+v._value+":"+v._args+"\n");this._args=v;this._value=value;this._loc=loc;this._state=0}throwRuntimeError(msg){throw new RuntimeError(this._loc.first_line,constructor_name(this)+": "+msg)}copy(){return this}getLoc(){return this._loc}getState(){return this._state}setState(i){this._state=i}getArgs(idx=null){if(idx===null)return this._args;else return this._args[idx]}clone(){this.throwRuntimeError("cloneが作られていません")}_makeValue(){this.throwRuntimeError("_makeValueが作られていません")}run(){if(this.getState()==0){code[0].stack.unshift({statementlist:this.getArgs(),index:0});this.setState(1)}else{code[0].stack[0].index++;this._makeValue();this.setState(0)}}getValue(){this.throwRuntimeError("getValueが作られていません")}getJSValue(){this.throwRuntimeError("getJSValueが作られていません")}setValue(){this.throwRuntimeError("setValueが作られていません")}argsPyPEN(){this.throwRuntimeError("argsPyPENが作られていません")}argsPython(){this.throwRuntimeError("argsPythonが作られていません")}valueString(){this.throwRuntimeError("valueStringが作られていません")}valueCode(){this.throwRuntimeError("valueCodeが作られていません")}}class PrimitiveValue extends Value{constructor(v,loc,value=null){super(v,loc,value)}run(){code[0].stack[0].index++;this._makeValue()}_makeValue(){this._value=this.getArgs(0)}getValue(){return this}getJSValue(){return this._value}setValue(v){this._args[0]=this._value=v.getJSValue()}argsPyPEN(){return this.getArgs(0).toString()}argsPython(){return this.getArgs(0).toString()}valueString(){return this._value.toString()}valueCode(){return this._value.toString()}}class SimpleValue extends Value{constructor(v,loc,value=null){super(v,loc,value)}run(){if(this.getState()==0){code[0].stack.unshift({statementlist:this.getArgs(),index:0});this.setState(1)}else{code[0].stack[0].index++;this._makeValue();this.setState(0)}}getValue(){return this._value}getJSValue(){return this._value.getJSValue()}setValue(v){this._args[0]=v;this._makeValue()}argsPyPEN(){return this.getArgs(0).argsPyPEN()}argsPython(){return this.getArgs(0).argsPython()}valueString(){return valueString(this.getJSValue())}valueCode(){return valueCode(this.getJSValue())}}class CollectionValue extends Value{constructor(v,loc,value=null){super(v,loc,value)}getValue(idx=null){if(idx===null)return this;return this._value[idx]}getJSValue(idx=null){if(idx===null)this.throwRuntimeError("引数なしのgetJSValueは使えません");return this._value[idx].getJSValue()}_makeValue(){this.throwRuntimeError("_makeValueが作られていません")}run(){if(this._state==0){code[0].stack.unshift({statementlist:this.getArgs(),index:0});this._state=1}else{code[0].stack[0].index++;this._makeValue();this._state=0}}}class IntValue extends PrimitiveValue{constructor(v,loc,value=null){super(v,loc,value===null?null:BigInt(value));Object.seal(this)}clone(){return new IntValue(this.getArgs(),this.getLoc(),this._value)}copy(){return new IntValue([this._value],this.getLoc(),this._value)}_makeValue(){try{this._value=BigInt(this.getArgs()[0])}catch(e){if(e instanceof RangeError)this.throwRuntimeError("整数で表せない値が使われました");else throw e}}}class FloatValue extends PrimitiveValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new FloatValue(this.getArgs(),this.getLoc(),this._value)}copy(){return new FloatValue([this._value],this.getLoc(),this._value)}_toString(v){if(isSafeInteger(v))return v.toFixed(1);else return v.toString()}argsPyPEN(){return this._toString(this.getArgs(0))}argsPython(){return this._toString(this.getArgs(0))}valueString(){return this._toString(this.getJSValue())}valueCode(){return this._toString(this.getJSValue())}}class StringValue extends PrimitiveValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new StringValue(this.getArgs(),this.getLoc(),this._value)}copy(){return new StringValue([this._value],this.getLoc(),this._value)}argsPyPEN(){return"'"+this.getArgs(0).replace(/'/g,"\\'")+"'"}argsPython(){return"'"+this.getArgs(0).replace(/'/g,"\\'")+"'"}valueString(){return this._value}valueCode(){return"'"+this._value.replace(/'/g,"\\'")+"'"}valueLength(){return this._value.length}}class BooleanValue extends PrimitiveValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BooleanValue(this.getArgs(),this.getLoc(),this._value)}copy(){return new BooleanValue([this._value],this.getLoc(),this._value)}valueString(){return this._value?"true":"false"}valueCode(){return this._value?"true":"false"}}class NullValue extends PrimitiveValue{constructor(loc){super([],loc);Object.seal(this)}clone(){return new NullValue(this.getLoc())}copy(){return new NullValue(this.getLoc())}argsPyPEN(){return""}argsPython(){return""}valueCode(){return""}valueString(){return""}}class UNDEFINED extends PrimitiveValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new UNDEFINED(this.getArgs(),this.getLoc(),this.getArgs(0))}run(){this.throwRuntimeError("未完成のプログラムです")}copy(){return new UNDEFINED([this.getArgs(0)],this.getLoc(),this.getArgs(0))}argsPyPEN(){return this.getArgs(0)}argsPython(){return this.getArgs(0)}valueCode(){return this.getArgs(0)}valueString(){return this.getArgs(0)}}class SliceValue extends CollectionValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new SliceValue([this.getArgs(0).clone(),this.getArgs(1).clone()],this.getLoc())}copy(){return new SliceValue([this.getArgs(0).copy(),this.getArgs(1).copy()],this.getLoc(),this._value)}_makeValue(){{this._value=[this.getArgs(0)instanceof PrimitiveValue?this.getArgs(0).getValue():this.getArgs(0),this.getArgs(1)instanceof PrimitiveValue?this.getArgs(1).getValue():this.getArgs(1)]}}argsPyPEN(){return this.getArgs(0).argsPyPEN()+":"+this.getArgs(1).argsPyPEN()}argsPython(){var p1=this.getArgs(0).argsPython();var p2=this.getArgs(1).argsPython();return p1+":"+p2}valueString(){return this.getArgs(0).valueString()+":"+this.getArgs(1).valueString()}valueCode(){return this.getArgs(0).valueCode()+":"+this.getArgs(1).valueCode()}setValue(v1,v2){if(!(v1 instanceof Value)||!(v2 instanceof Value))this.throwRuntimeError("SliceValue#setValueの引数はValueでなければなりません");this._args[0]=v1;this._args[1]=v2;this._makeValue()}getValue1(){return this._value[0]}getValue2(){return this._value[1]}valueLength(){return 2}}class ArrayValue extends CollectionValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){var a=[],v=[];for(var i of this.getArgs())a.push(i.clone());if(this._value)for(var i of this._value)v.push(i.clone());return new ArrayValue(a,this.getLoc())}copy(){var a=[],v=[];for(var i of this.getValue()._value)a.push(i.copy());return new ArrayValue(a,this.getLoc(),a)}_makeValue(){{this._value=[];for(var i=0;i<this.getArgs().length;i++)this._value.push(this.getArgs(i).getValue())}}getValue(idx=null){if(idx===null)return this;if(idx<0)idx+=this._value.length;if(idx>=0&&idx<this._value.length)return this._value[idx];else this.throwRuntimeError("リストの範囲外の値を取得しようとしました")}getJSValue(idx=null){if(idx===null)return this._value;if(idx<0)idx+=this._value.length;if(idx>=0&&idx<this._value.length)return this._value[idx].getJSValue();else this.throwRuntimeError("リストの範囲外の値を取得しようとしました")}setValue(v,idx){if(idx<0)idx+=this._value.length;if(idx>=0&&idx<this._value.length){this._args[idx]=v;this._makeValue()}else this.throwRuntimeError("リストの範囲外に値を設定しようとしました")}argsPyPEN(){var v=[];for(var i=0;i<this.getArgs().length;i++)v.push(this.getArgs(i).argsPyPEN());return"["+v.join(", ")+"]"}argsPython(){var v=[];for(var i=0;i<this.getArgs().length;i++)v.push(this.getArgs(i).argsPython());return"["+v.join(", ")+"]"}valueString(){var v=[];for(var i=0;i<this._value.length;i++)v.push(valueCode(this._value[i]));return"["+v.join(", ")+"]"}valueCode(){var v=[];for(var i=0;i<this._value.length;i++)v.push(valueCode(this._value[i]));return"["+v.join(", ")+"]"}append(a){this._args.push(a);this._makeValue()}extend(a){for(var i of a){this._args.push(i)}this._makeValue()}valueLength(){return this._value.length}}class DictionaryValue extends CollectionValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){var a=[],m=new Map;for(var arg of this._args){a.push(arg.copy());var key=arg.getValue1();var val=arg.getValue2();m.set(key.getJSValue(),val.clone())}return new DictionaryValue(a,this.getLoc(),m)}copy(){var a=[],m=new Map;for(var arg of this._args){a.push(arg.copy());var key=arg.getValue1();var val=arg.getValue2();m.set(key.getJSValue(),val.copy())}return new DictionaryValue(a,this.getLoc(),m)}_makeValue(){{this._value=new Map;for(var i=0;i<this.getArgs().length;i++){if(this.getArgs(i)instanceof SliceValue){var key=this.getArgs(i).getValue1();var val=this.getArgs(i).getValue2();if(isPrimitive(key))this._value.set(key.getJSValue(),val);else this.throwRuntimeError("辞書のキーには単純型しか使えません")}else this.throwRuntimeError("辞書の初期化が間違っています")}}}getValue(key=null){if(key===null)return this;if(isPrimitive(key))return this._value.get(key.getJSValue());else this.throwRuntimeError("辞書のキーには単純型しか使えません")}getJSValue(key=null){if(key===null)this.throwRuntimeError("引数なしのgetJSValueは使えません");if(isPrimitive(key))return this._value.get(key.getJSValue()).getJSValue();else this.throwRuntimeError("辞書のキーには単純型しか使えません")}setValue(v,key){if(isPrimitive(key)){for(var i in this._args)if(this._args[i].getValue1().getJSValue()===key.getJSValue()){this._args[i]=new SliceValue([key,v],this.getLoc(),[key,v]);this._makeValue();return}this._args.push(new SliceValue([key,v],this.getLoc(),[key,v]));this._makeValue()}else this.throwRuntimeError("辞書のキーには単純型しか使えません")}argsPyPEN(){var ag=[];for(var arg of this.getArgs())ag.push(arg.argsPyPEN());return"{"+ag.join(", ")+"}"}argsPython(){var ag=[];for(var arg of this._args)ag.push(arg.argsPython());return"{"+ag.join(", ")+"}"}valueString(){var ag=[];for(var[k,v]of this._value.entries()){if(typeof k==="string")k="'"+k+"'";ag.push(k+":"+v.valueCode())}return"{"+ag.join(", ")+"}"}valueCode(){var ag=[];for(var[k,v]of this._value.entries()){if(typeof k==="string")k="'"+k.replace(/'/g,"\\'")+"'";ag.push(k+":"+v.valueCode())}return"{"+ag.join(", ")+"}"}}class Copy extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Copy([this.getArgs(0).clone()],this.getLoc())}copy(){return new Copy([this.getArgs(0).copy()],this.getLoc())}_makeValue(){var v=this.getArgs(0).getValue().copy();this._value=v}argsPyPEN(){return"copy("+this.getArgs(0).getPyPEN()+")"}argsPython(){return this.getArgs(0).argsPython()+".copy()"}valueString(){return this.getValue().valueString()}valueCode(){return this.getValue().valueCode()}}class Variable extends SimpleValue{constructor(x,loc,value=null){super([],loc,value);this.varname=x;Object.seal(this);if(debug_mode&&!(loc instanceof Location))textareaAppend("Error Variable#constructor: "+x+": "+constructor_name(loc)+"\n")}clone(){var a=[];for(var i of this.getArgs())a.push(i.clone());var rtnv=new Variable(this.varname,this.getLoc(),this._value?this._value.clone():null);rtnv._args=a;return rtnv}_makeValue(){var vt=findVarTable(this.varname);if(vt){var v=vt.vars[this.varname];this._value=getValueByArgs(v,this.getArgs(),this.getLoc());if(!(this._value instanceof Value))this.throwRuntimeError("代入する値が不明です(_makeValue): "+constructor_name(this._value))}else this.throwRuntimeError("変数に"+this.varname+"がありません")}setValue(v){setVariableByArgs(this.varname,v,this.getArgs(),this.getLoc());this._makeValue()}argsPyPEN(){if(this.getArgs().length>0){let ag=[];for(var i of this.getArgs())ag.push(i.argsPyPEN());return this.varname+"["+ag.join(", ")+"]"}return this.varname}argsPython(){if(this.getArgs().length>0){let ag=[];for(var i of this.getArgs())ag.push(i.argsPython());return this.varname+"["+ag.join(", ")+"]"}return this.varname}valueString(){return valueString(this.getValue())}valueCode(){return valueCode(this.getValue())}append(a){this._args.push(a)}extend(a){for(var i of a)this._args.push(i)}}class Pow extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Pow(this.getArgs(),this._loc,this._value?this._value.clone():null)}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof IntValue&&v2 instanceof IntValue){v1=v1.getJSValue();v2=v2.getJSValue();if(v1==0&&v2<=0)this.throwRuntimeError("0は正の数乗しかできません");try{if(v2>=0){var v=v1**v2;this._value=new IntValue([v],this.getLoc(),v)}else{var v=Number(v1)**Number(v2);this._value=new FloatValue([v],this.getLoc(),v)}}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}else if((v1 instanceof IntValue||v1 instanceof FloatValue)&&(v2 instanceof IntValue||v2 instanceof FloatValue)){v1=Number(v1.getJSValue());v2=Number(v2.getJSValue());if(v1<0&&!Number.isSafeInteger(v2))this.throwRuntimeError("負の数の非整数乗はできません");if(v1==0&&v2<=0)this.throwRuntimeError("0は正の数乗しかできません");try{let v=v1**v2;if(isFinite(v))this._value=new FloatValue([v],this.getLoc(),v);else this.throwRuntimeError("オーバーフローしました")}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}else this.throwRuntimeError("数値でないもののべき乗はできません")}getCode(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub"||c1=="Mul"||c1=="Div"||c1=="DivInt"||c1=="Mod")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub"||c2=="Mul"||c2=="Div"||c2=="DivInt"||c2=="Mod")brace2=true;return(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"**"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub"||c1=="Mul"||c1=="Div"||c1=="DivInt"||c1=="Mod")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub"||c2=="Mul"||c2=="Div"||c2=="DivInt"||c2=="Mod")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" ** "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Add extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Add(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof Array&&v2 instanceof Array){let v=[];for(let i=0;i<v1.length;i++)v.push(v1[i]);for(let i=0;i<v2.length;i++)v.push(v2[i]);this._value=new ArrayValue([v],this.getLoc(),v)}else if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストと足し算ができるのはリストどうしだけです");else if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)this.throwRuntimeError("真偽型の足し算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue){var s=v1.getJSValue()+v2.getJSValue();this._value=new StringValue([s],this.getLoc(),s)}else{if(v1 instanceof FloatValue||v2 instanceof FloatValue){let v=Number(v1.getJSValue())+Number(v2.getJSValue());if(!isFinite(v))this.throwRuntimeError("オーバーフローしました");this._value=new FloatValue([v],this.getLoc(),v)}else{try{var v=v1.getJSValue()+v2.getJSValue();this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus")brace1=true;if(c2=="Minus")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"+"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus")brace1=true;if(c2=="Minus")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" + "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Sub extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Sub(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの引き算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)this.throwRuntimeError("真偽型の引き算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の引き算はできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue){v1=v1.getJSValue();v2=v2.getJSValue();let v=Number(v1)-Number(v2);if(!isFinite(v))this.throwRuntimeError("オーバーフローしました");this._value=new FloatValue([v],this.getLoc(),v)}else{try{v1=v1.getJSValue();v2=v2.getJSValue();let v=v1-v2;this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus")brace1=true;if(c2=="Minus")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"-"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus")brace1=true;if(c2=="Minus")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" - "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Mul extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Mul(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)this.throwRuntimeError("真偽型のかけ算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue){let va=null,vn=null;if(v1 instanceof IntValue){va=v2.getJSValue();vn=Number(v1.getJSValue())}else if(v2 instanceof IntValue){va=v1.getJSValue();vn=Number(v2.getJSValue())}else this.throwRuntimeError("文字列には整数しか掛けられません");let v="";for(let i=0;i<vn;i++)v+=va;this._value=new StringValue([v],this.getLoc(),v)}else if(v1 instanceof Array||v2 instanceof Array){let va=null,vn=null;if(v1 instanceof IntValue){va=v2;vn=v1.getJSValue()}else if(v2 instanceof IntValue){va=v1;vn=v2.getJSValue()}else this.throwRuntimeError("リストには整数しか掛けられません");let v=[];for(let i=0;i<vn;i++)for(let j=0;j<va.length;j++)v.push(va[j]);this._value=new ArrayValue([v],this.getLoc(),v)}else{if(v1 instanceof FloatValue||v2 instanceof FloatValue){let v=Number(v1.getJSValue())*Number(v2.getJSValue());if(!isFinite(v))this.throwRuntimeError("オーバーフローしました");this._value=new FloatValue([v],this.getLoc(),v)}else{try{var v=v1.getJSValue()*v2.getJSValue();this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"*"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" * "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Div extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Div(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのわり算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)this.throwRuntimeError("真偽型のわり算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のわり算はできません");if(v2.getJSValue()==0)this.throwRuntimeError("0でわり算をしました");try{let v=Number(v1.getJSValue())/Number(v2.getJSValue());if(!isFinite(v))this.throwRuntimeError("オーバーフローしました");this._value=new FloatValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"/"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" / "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class DivInt extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new DivInt(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのわり算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)this.throwRuntimeError("真偽型のわり算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のわり算はできません");if(v2.getJSValue()==0)this.throwRuntimeError("0でわり算をしました");try{if(v1 instanceof IntValue&&v2 instanceof IntValue){let r=v1.getJSValue()%v2.getJSValue();let q=v1.getJSValue()/v2.getJSValue();if(!SameSignBigInt(v1.getJSValue(),v2.getJSValue())&&r!=0)q--;this._value=new IntValue([q],this.getLoc(),q)}else{v1=Number(v1.getJSValue());v2=Number(v2.getJSValue());let v=Math.floor(v1/v2);this._value=new FloatValue([v],this.getLoc(),v)}}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"//"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" // "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Mod extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Mod(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof IntValue&&v2 instanceof IntValue){let r=v1.getJSValue()%v2.getJSValue();let q=(v1.getJSValue()-r)/v2.getJSValue();if(!SameSignBigInt(v1.getJSValue(),v2.getJSValue())&&r!=0)q--;var v=v1.getJSValue()-q*v2.getJSValue();this._value=new IntValue([v],this.getLoc(),v)}else{v1=Number(v1.getJSValue());v2=Number(v2.getJSValue());var v=v1-Math.floor(v1/v2)*v2;this._value=new FloatValue([v],this.getLoc(),v)}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"%"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;if(c2=="Minus"||c2=="Add"||c2=="Sub")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" % "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Minus extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Minus(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue();if(v1 instanceof IntValue){try{var v=-v1.getJSValue();this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}else if(v1 instanceof FloatValue){let v=-v1.getJSValue();if(!isFinite(v))this.throwRuntimeError("オーバーフローしました");this._value=new FloatValue([v],this.getLoc(),v)}else this.throwRuntimeError("マイナスは数値にしかつけられません")}argsPyPEN(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;return"-"+(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")}argsPython(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;if(c1=="Minus"||c1=="Add"||c1=="Sub")brace1=true;return"-"+(brace1?"(":"")+v1.argsPython()+(brace1?")":"")}}class And extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new And(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue();if(v1 instanceof BooleanValue){if(!v1.getJSValue()){this._value=new BooleanValue([false],this.getLoc(),false)}else{let v2=this.getArgs()[1].getValue();if(v2 instanceof BooleanValue){var v=v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}}}else this.throwRuntimeError("and は真偽値にしか使えません")}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c2=="And"||c2=="Or"||c2=="Not")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+" and "+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c2=="And"||c2=="Or"||c2=="Not")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" and "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Or extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Or(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.args[0].getValue();if(v1 instanceof BooleanValue){if(v1.getJSValue()){this._value=new BooleanValue([true],this.getLoc(),true)}else{let v2=this.args[1].getValue();if(v2 instanceof BooleanValue){var v=v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}}}else this.throwRuntimeError("or は真偽値にしか使えません")}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c2=="And"||c2=="Or"||c2=="Not")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+" or "+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c2=="And"||c2=="Or"||c2=="Not")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" or "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class Not extends SimpleValue{constructor(v,loc,value=null){super([v],loc,value);Object.seal(this)}clone(){return new Not(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue();if(v1 instanceof BooleanValue){var v=!v1.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}else this.throwRuntimeError("not は真偽値にしか使えません")}argsPyPEN(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;return"not "+(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")}argsPython(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;if(c1=="And"||c1=="Or"||c1=="Not")brace2=true;return"not "+(brace1?"(":"")+v1.argsPython()+(brace1?")":"")}}class BitAnd extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitAnd(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビット積はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビット積はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue){var v=v1.getJSValue()&v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビット積はできません");else{try{v1=v1 instanceof BooleanValue?v1.getJSValue()?1:0:v1.getJSValue();v2=v2 instanceof BooleanValue?v2.getJSValue()?1:0:v2.getJSValue();this._value=new IntValue([v1&v2],this.getLoc(),v1&v2)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"&"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" & "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class BitOr extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitOr(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビット和はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビット和はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue){var v=v1.getJSValue()|v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビット和はできません");else{try{v1=v1 instanceof BooleanValue?v1.getJSValue()?1:0:v1.getJSValue();v2=v2 instanceof BooleanValue?v2.getJSValue()?1:0:v2.getJSValue();var v=v1|v2;this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"|"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" | "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class BitXor extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitXor(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.args[0].getValue(),v2=this.args[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの排他的ビット和はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の排他的ビット和はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue){var v=v1.getJSValue()^v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数の排他的ビット和はできません");else{try{v1=v1 instanceof BooleanValue?v1.getJSValue()?1:0:v1.getJSValue();v2=v2 instanceof BooleanValue?v2.getJSValue()?1:0:v2.getJSValue();var v=v1^v2;this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"^"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitRShift"||c2=="BitLShift"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" ^ "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class BitNot extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitNot(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.args[0].getValue();if(v1 instanceof ArrayValue)this.throwRuntimeError("リストのビット反転はできません");else if(v1 instanceof StringValue)this.throwRuntimeError("文字列のビット反転はできません");else if(v1 instanceof BooleanValue){var v=!v1.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue)this.throwRuntimeError("実数のビット反転はできません");else{try{var v=v1 instanceof BooleanValue?v1.getJSValue()?0:1:~v1.getJSValue();this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift")brace1=true;return"~"+(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")}argsPython(){let v1=this.getArgs()[0];let c1=constructor_name(v1);let brace1=false;if(c1=="Minus"||c1=="BitRShift"||c1=="BitLShift")brace1=true;return"~"+(brace1?"(":"")+v1.argsPython()+(brace1?")":"")}}class BitLShift extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitLShift(this.getArgs(),this.getLoc())}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビットシフトはできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビットシフトはできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビットシフトはできません");else{try{v1=v1 instanceof BooleanValue?v1.getJSValue()?1:0:v1.getJSValue();v2=v2 instanceof BooleanValue?v2.getJSValue()?1:0:v2.getJSValue();var v=v1<<v2;this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"<<"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" << "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class BitRShift extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new BitRShift(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}_makeValue(){let v1=this.getArgs()[0].getValue(),v2=this.getArgs()[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビットシフトはできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビットシフトはできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビットシフトはできません");else{try{v1=v1 instanceof BooleanValue?v1.getJSValue()?1:0:v1.getJSValue();v2=v2 instanceof BooleanValue?v2.getJSValue()?1:0:v2.getJSValue();var v=v1>>v2;this._value=new IntValue([v],this.getLoc(),v)}catch(e){if(e instanceof RangeError)this.throwRuntimeError("計算できない値です");else throw e}}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+">>"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let c1=constructor_name(v1),c2=constructor_name(v2);let brace1=false,brace2=false;if(c1=="Minus"||c1=="BitNot")brace1=true;if(c2=="Minus"||c2=="BitNot")brace2=true;return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+" >> "+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}function ArrayCompare(v1,v2){var rtnv=true;if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue){if(v1.valueLength!=v2.valueLength)return false;for(let i=0;i<v1.valueLength;i++)rtnv=rtnv&&ArrayCompare(v1.getValue().getArgs()[i],v2.getValue().getArgs()[i])}else rtnv=rtnv&&typeof v1==typeof v2&&v1.getJSValue()==v2.getJSValue();return rtnv}class Compare extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new Compare(this.getArgs(),this.getLoc())}run(){if(this.getState()==0){code[0].stack.unshift({statementlist:[this.getArgs()[0]],index:0});this.setState(1)}else if(this.getState()==1){if(this.getArgs()[0]instanceof Compare&&!this.getArgs()[0].getJSValue()){code[0].stack[0].index++;this.setState(0);this._value=new BooleanValue([false],this.getLoc(),false)}else{code[0].stack.unshift({statementlist:[this.getArgs()[2]],index:0});this.setState(2)}}else{code[0].stack[0].index++;this.setState(0);this._makeValue()}}_makeValue(){var v1,v2=this.getArgs()[2];if(this.getArgs()[0]instanceof Compare)v1=this.getArgs()[0].getArgs()[2].getValue();else v1=this.getArgs()[0].getValue();switch(this.getArgs()[1]){case"==":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue){var v=ArrayCompare(v1,v2);this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書は比較できません");else if(v1 instanceof StringValue!=v2 instanceof StringValue)this.throwRuntimeError("文字列とそれ以外の値は比べられません");else if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)this.throwRuntimeError("真偽値とそれ以外の値は比べられません");else{var v=v1.getJSValue()==v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}break;case"!=":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue){var v=!ArrayCompare(v1,v2);this._value=new BooleanValue([v],this.getLoc(),v)}else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書は比較できません");else if(v1 instanceof StringValue!=v2 instanceof StringValue)this.throwRuntimeError("文字列とそれ以外の値は比べられません");else if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)this.throwRuntimeError("真偽値とそれ以外の値は比べられません");else{var v=v1.getJSValue()!=v2.getJSValue();this._value=new BooleanValue([v],this.getLoc(),v)}break;case">":case"<":case">=":case"<=":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストを比べることはできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書は比較できません");else if(v1 instanceof StringValue!=v2 instanceof StringValue)this.throwRuntimeError("文字列とそれ以外の値は比べられません");else if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)this.throwRuntimeError("真偽値とそれ以外の値は比べられません");else{switch(this.getArgs()[1]){case">":var v=v1.getJSValue()>v2.getJSValue();break;case"<":var v=v1.getJSValue()<v2.getJSValue();break;case">=":var v=v1.getJSValue()>=v2.getJSValue();break;case"<=":var v=v1.getJSValue()<=v2.getJSValue();break}this._value=new BooleanValue([v],this.getLoc(),v)}break;case"の中に":if(v1 instanceof ArrayValue){var flag=false;for(let i=0;i<v1.getJSValue().length;i++)flag|=ArrayCompare(v1.getJSValue()[i],v2);this._value=new BooleanValue([flag],this.getLoc(),flag)}else this.throwRuntimeError('"の中に"の前にはリストが必要です');break;case"in":if(v2 instanceof ArrayValue){var flag=false;for(let i=0;i<v2.getJSValue().length;i++)flag|=ArrayCompare(v2.getJSValue()[i],v1);this._value=new BooleanValue([flag],this.getLoc(),flag)}else this.throwRuntimeError('"in"の後にはリストが必要です');break;case"not in":if(v2 instanceof ArrayValue){var flag=false;for(let i=0;i<v2.getJSValue().length;i++)flag|=ArrayCompare(v2.getJSValue()[i],v1);this._value=new BooleanValue([!flag],this.getLoc(),!flag)}else this.throwRuntimeError('"not in"の後にはリストが必要です')}}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[2];let brace1=false,brace2=false;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+this.getArgs()[1]+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[2];let brace1=false,brace2=false;var op=this.getArgs()[1];switch(op){case"not in":op=" not in ";break;case"in":op=" in ";break;case"の中に":op=" in ";var tmp=v1;v1=v2;v2=tmp;break;case"=":op=" == ";break;default:op=" "+op+" "}return(brace1?"(":"")+v1.argsPython()+(brace1?")":"")+op+(brace2?"(":"")+v2.argsPython()+(brace2?")":"")}}class NumberOf extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);this.statementlist=null;Object.seal(this)}clone(){return new NumberOf(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}run(){if(this.getState()==0){code[0].stack.unshift({statementlist:[this.getArgs()[0]],index:0});this.getState(1)}else if(this.getState()==1){for(var i=0;i<this.getArgs()[0].getJSValue();i++)statementlist.push(this.getArgs()[1].clone());code[0].stack.unshift({statementlist:statementlist,index:0});this.setState(2)}else{code[0].stack[0].index++;this.setState(0);this._makeValue()}}_makeValue(){var a=[];for(var i of this.statementlist)a.push(i.getValue());this._value=new ArrayValue(a,this.getLoc(),a)}argsPyPEN(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let brace1=false,brace2=false;return(brace1?"(":"")+v1.argsPyPEN()+(brace1?")":"")+"個の"+(brace2?"(":"")+v2.argsPyPEN()+(brace2?")":"")}argsPython(){let v1=this.getArgs()[0],v2=this.getArgs()[1];let brace1=false,brace2=false;return"["+(brace1?"(":"")+v2.argsPython()+(brace1?")":"")+" for _ in range("+(brace2?"(":"")+v1.argsPython()+(brace2?")":"")+")]"}}class ConvertInt extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new ConvertInt(this.getArgs(),this.getLoc())}_makeValue(){let v=this.getArgs(0).getValue();let r=Number.NaN;if(v instanceof IntValue)r=v.getJSValue();else if(v instanceof FloatValue)r=Math.floor(v.getJSValue());else if(v instanceof StringValue)r=Math.floor(Number(v.getJSValue()));else if(v instanceof BooleanValue)r=v.getJSValue()?1:0;else this.throwRuntimeError("整数に直せません");this._value=new IntValue([r],this.getLoc(),r)}argsPyPEN(){return"整数("+this.getArgs()[0].argsPyPEN()+")"}argsPython(){return"int("+this.getArgs()[0].argsPython()+")"}}class ConvertFloat extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new ConvertFloat(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}_makeValue(){let v=this.getArgs()[0].getValue();let r=Number.NaN;if(v instanceof IntValue||v instanceof FloatValue)r=v.getJSValue();else if(v instanceof StringValue)r=Number(v.getJSValue());else if(v instanceof BooleanValue)r=v.getJSValue()?1:0;else this.throwRuntimeError("実数に直せません");if(isFinite(r))this._value=new FloatValue([r],this.getLoc(),r);else this.throwRuntimeError("実数に直せません")}argsPyPEN(){return"実数("+this.getArgs()[0].argsPyPEN()+")"}argsPython(){return"float("+this.getArgs()[0].argsPython()+")"}}class ConvertString extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new ConvertString(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}_makeValue(){let v=this.getArgs()[0].getValue();let r="";if(v instanceof IntValue||v instanceof FloatValue)r=String(v.getJSValue());else if(v instanceof StringValue)r=v.getJSValue();else if(v instanceof BooleanValue)r=v.getJSValue()?"true":"false";this._value=new StringValue([r],this.getLoc(),r)}argsPyPEN(){return"文字列("+this.getArgs()[0].argsPyPEN()+")"}argsPython(){return"str("+this.getArgs()[0].argsPython()+")"}}function toBool(v){let re=/^(0+|false|偽|)$/i;if(typeof v==="boolean")return v;else if(v instanceof IntValue||v instanceof FloatValue)return v.getValue()!=0;else if(v instanceof StringValue)return re.exec(v.getValue())?false:true;else if(v instanceof BooleanValue)return v.getValue();else if(v instanceof ArrayValue)return v.getValue().valueLength()!=0;else if(v instanceof DictionaryValue)return v.getValue().size()!=0;else throw new RuntimeError(null,"真偽値に直せません")}class ConvertBool extends SimpleValue{constructor(v,loc,value=null){super(v,loc,value);Object.seal(this)}clone(){return new ConvertBool(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}_makeValue(){let v=toBool(this.getArgs()[0].getValue());this._value=new BooleanValue([v],this.getLoc(),v)}argsPyPEN(){return"真偽("+this.getArgs()[0].argsPyPEN()+")"}argsPython(){return"bool("+this.getArgs()[0].argsPython()+")"}}class CallFunction extends SimpleValue{constructor(v,loc,value=null){super(v[1],loc,value);if(v[1]instanceof Array==false)this.throwRuntimeError("DEBUG: 関数の引数がArrayではありません"+"\n"+constructor_name(v[1]));this.funcname=v[0];Object.seal(this)}clone(){var parm=[];for(var i=0;i<this.getArgs().length;i++)parm.push(this.getArgs()[i].clone());return new CallFunction([this.funcname,parm],this.getLoc())}setValue(v,idx=null){if(idx!==null)this.throwRuntimeError("これはおかしい");this._value=v}_makeValue(){if(definedFunction[this.funcname]){let fn=definedFunction[this.funcname].clone();fn.setCaller(this,false);var a=[];for(var i of this.getArgs()){a.push(i)}fn.setParameter(a);fn.setLocation(this.getLoc());let statementlist=[fn];code.unshift(new parsedFunction(statementlist))}else if(myFuncs[this.funcname]){let fn=myFuncs[this.funcname];let vt=new varTable;let globalVarTable=varTables[varTables.length-1];for(let i of Object.keys(globalVarTable.vars))vt.vars[i]=globalVarTable.vars[i].copy();for(let i=0;i<this.getArgs().length;i++)vt.vars[fn.params[i].varname]=this.getArgs()[i].getValue();let statementlist=cloneStatementlist(fn.statementlist);statementlist.push(new ReturnStatement(new NullValue(this.getLoc()),this.getLoc()));setCaller(statementlist,this);let pf=new parsedFunction(statementlist);code.unshift(pf);varTables.unshift(vt)}else this.throwRuntimeError("関数 "+this.funcname+" は定義されていません")}argsPyPEN(indent=0){let ag=[];for(let i=0;i<this.getArgs().length;i++)ag.push(this.getArgs()[i].argsPyPEN());return makeIndent(indent)+this.funcname+"("+ag.join(", ")+")"}argsPython(indent=0){let deffunc=null;if(definedFunction[this.funcname])deffunc=definedFunction[this.funcname];else if(myFuncs[this.funcname])deffunc=myFuncs[this.funcname];let ag=[];for(let i=0;i<this.getArgs().length;i++)ag.push(this.getArgs()[i].argsPython(indent));if(deffunc){var prefix="";if(deffunc.module){prefix=deffunc.module+".";python_lib[deffunc.module]=1}if(deffunc.convert)return makeIndent(indent)+deffunc.convert(ag);else return makeIndent(indent)+prefix+this.funcname+"("+ag.join(", ")+")"}else return makeIndent(indent)+this.funcname+"("+ag.join(", ")+")"}}class Connect extends Value{constructor(v,loc,value=null){super(v,loc,value);this.state=0}clone(){return new Connect(this.getArgs(),this.getLoc(),this._value?this._value.clone():null)}_makeValue(){let v1=valueString(this.getArgs()[0]);let v2=valueString(this.getArgs()[1]);let v=v1+v2;this._value=new StringValue([v],this.getLoc(),v)}getValue(){if(this._value==null)this._makeValue();return this._value}argsPyPEN(){return argsPyPEN(this.getArgs(0))+"と"+argsPyPEN(this.getArgs(1))}argsPython(){var re=/^str\(/;var p1=this.getArgs()[0].argsPython();var p2=this.getArgs()[1].argsPython();if(!re.exec(p1)&&!(this.getArgs()[0]instanceof StringValue))p1="str("+p1+")";if(!re.exec(p2)&&!(this.getArgs()[1]instanceof StringValue))p2="str("+p2+")";return p1+" + "+p2}valueString(){return this.getArgs()[0].valueString()+this.getArgs()[1].valueString()}valuePython(){var re=/^str\(/;var p1=this.getArgs()[0].valuePython();var p2=this.getArgs()[1].valuePython();if(!re.exec(p1)&&!(this.getArgs(0)instanceof StringValue))p1="str("+p1+")";if(!re.exec(p2)&&!(this.getArgs(1)instanceof StringValue))p2="str("+p2+")";return p1+" + "+p2}}class Assign extends SimpleValue{constructor(variable,value,operator,loc){super([value],loc);this.variable=variable;this.operator=operator;if(!(variable instanceof Variable||variable instanceof UNDEFINED))this.throwRuntimeError("変数でないものに代入はできません");Object.seal(this)}clone(){return new Assign(this.variable,this.getArgs()[0].clone(),this.operator,this.getLoc())}run(){if(this.variable instanceof UNDEFINED)this.throwRuntimeError("未完成のプログラムです");if(this.getState()==0){let a=[];if(this.operator)a.push(this.variable);a.push(this.getArgs()[0]);code[0].stack.unshift({statementlist:a,index:0});this.setState(1)}else if(this.getState()==1){if(!this.operator&&this.variable.getArgs().length>0)code[0].stack.unshift({statementlist:this.variable.getArgs(),index:0});this.setState(2)}else if(this.getState()==2){var vt1=findVarTable(this.variable.varname);var v2=this.getArgs()[0].getValue();if(this.operator){if(!vt1)this.throwRuntimeError("変数 "+this.variable.varname+" は定義されていません");var v1=getValueByArgs(vt1.vars[this.variable.varname],this.variable.getArgs()?this.variable.getArgs():null,this.getLoc());var v3=null;switch(this.operator){case"+":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue){var v=[];for(var i of v1.getJSValue())v.push(i);for(var i of v2.getJSValue())v.push(i);v3=new ArrayValue(v,this.getLoc(),v)}else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の足し算はまだサポートしていません");else if(v1 instanceof StringValue||v2 instanceof StringValue){var v=String(v1.getJSValue())+String(v2.getJSValue());v3=new StringValue([v],this.getLoc(),v)}else if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()+v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue){var v=Number(v1.getJSValue())+Number(v2.getJSValue());v3=new FloatValue([v],this.getLoc(),v)}break;case"-":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの引き算はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の引き算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の引き算はできません");else if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()-v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue){var v=Number(v1.getJSValue())-Number(v2.getJSValue());v3=new FloatValue([v],this.getLoc(),v)}break;case"*":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの掛け算は出来ません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の掛け算はできません");else if(v1 instanceof StringValue){if(v2 instanceof IntValue){v="";for(var i=0;i<v2.getJSValue();i++)v+=v1.getJSValue();v3=new StringValue([v],this.getLoc(),v)}else this.throwRuntimeError("文字列に掛けられるのは整数だけです")}else if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()*v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}else if(v1 instanceof FloatValue||v2 instanceof FloatValue){var v=Number(v1.getJSValue())*Number(v2.getJSValue());v3=new FloatValue([v],this.getLoc(),v)}break;case"/":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの割り算はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の割り算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の割り算はできません");else{if(v2.args==0)this.throwRuntimeError("0で割り算をしました");var v=Number(v1.getJSValue())/Number(v2.getJSValue());v3=new FloatValue([v],this.getLoc(),v)}break;case"//":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの割り算はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の割り算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の割り算はできません");else if(v1 instanceof IntValue&&v2 instanceof IntValue){let q=v1.args/v2.args,r=v1.args%v2.args;if(!SameSignBigInt(v1.args,v2.args)&&r!=0)q--;v3=new IntValue([q],this.getLoc(),q)}else{if(Number(v2.args)==0)this.throwRuntimeError("0で割り算をしました");let v=Math.floor(Number(v1.args)/Number(v2.args));v3=new FloatValue([v],this.getLoc(),v)}break;case"%":if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストの割り算はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の割り算はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の割り算はできません");else if(v1 instanceof IntValue&&v2 instanceof IntValue){let q=v1.getJSValue()/v2.getJSValue(),r=v1.getJSValue()%v2.getJSValue();if(!SameSignBigInt(v1.getJSValue(),v2.getJSValue())&&r!=0)q--;var v=r-q*v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}else{if(Number(v2.getJSValue())==0)this.throwRuntimeError("0で割り算をしました");let v=Math.floor(Number(v1.getJSValue())/Number(v2.getJSValue()));v=Number(v1.getJSValue())-v*Number(v2.getJSValue());v3=new FloatValue([v],this.getLoc(),v)}break;case"&":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビット積はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書のビット積はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビット積はできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビット積はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)v3=new BooleanValue(v1.args&&v2.args,this.getLoc());else{if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getsJSValue()&v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}}break;case"|":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.throwRuntimeError("リストのビット和はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書のビット和はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビット和はできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビット和はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)v3=new BooleanValue(v1.args&&v2.args,this.getLoc());else{if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()|v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}}break;case"^":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)this.throwRuntimeError("リストの排他的論理和はできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書の排他的論理和はできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列の排他的論理和はできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数の排他的論理和はできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)v3=new BooleanValue(v1.args&&v2.args,this.getLoc());else{if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()^v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}}break;case"<<":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)this.throwRuntimeError("リストのビットシフトはできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書のビットシフトはできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビットシフトはできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビットシフトはできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)v3=new BooleanValue(v1.args&&v2.args,this.getLoc());else{if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()<<v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}}break;case">>":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)this.throwRuntimeError("リストのビットシフトはできません");else if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)this.throwRuntimeError("辞書のビットシフトはできません");else if(v1 instanceof StringValue||v2 instanceof StringValue)this.throwRuntimeError("文字列のビットシフトはできません");else if(v1 instanceof FloatValue||v2 instanceof FloatValue)this.throwRuntimeError("実数のビットシフトはできません");else if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)v3=new BooleanValue(v1.args&&v2.args,this.getLoc());else{if(v1 instanceof BooleanValue){var v=v1.getJSValue()?1:0;v1=new IntValue([v],this.getLoc(),v)}if(v2 instanceof BooleanValue){var v=v2.getJSValue()?1:0;v2=new IntValue([v],this.getLoc(),v)}if(v1 instanceof IntValue&&v2 instanceof IntValue){var v=v1.getJSValue()>>v2.getJSValue();v3=new IntValue([v],this.getLoc(),v)}}break}if(!v3)this.throwRuntimeError("複合代入演算子の使い方が間違っています");setVariableByArgs(vt1,this.variable.varname,this.variable.getArgs(),v3.getValue(),this.getLoc());this._value=v3.getValue()}else{if(!vt1){vt1=varTables[0];vt1.vars[this.variable.varname]=new NullValue(this.getLoc())}setVariableByArgs(vt1,this.variable.varname,this.variable.getArgs(),v2,this.getLoc());this._value=v2}this._state=0;code[0].stack[0].index++;this._makeValue()}}_makeValue(){if(!(this._value instanceof Value))this.throwRuntimeError("代入する値が不明です")}argsPython(indent=0){var code=makeIndent(indent);code+=argsPython(this.variable)+" ";if(this.operator)code+=this.operator;code+="= "+argsPython(this.getArgs(0));return code}}function setVariableByArgs(vt,vn,args,newval,loc){if(!(newval instanceof Value))throw new RuntimeError(loc.first_line,"代入する値が不明です"+"\n"+constructor_name(newval));if(args&&args.length>0){var v=vt.vars[vn];for(var i=0;i<args.length-1;i++){var arg=args[i];if(v.getValue()instanceof ArrayValue){if(arg.getValue()instanceof IntValue){var idx=Number(arg.getJSValue());var l=v.valueLength();if(idx<0)idx+=l;if(idx>=0&&idx<l)v=v.getValue(idx);else throw new RuntimeError(loc.first_line,"リストの範囲を超えています")}else throw new RuntimeError(loc.first_line,"リストの添字は整数でなければなりません")}else if(v.getValue()instanceof DictionaryValue){if(isPrimitive(arg)){var key=arg.getJSValue();if(v.getValue().has(key))v=v.getValue().get(key);else throw new RuntimeError(loc.first_line,"辞書にキー"+key+"がありません")}else throw new RuntimeError(loc.first_line,"辞書の添字は単純型でなければなりません")}else if(v.getValue()instanceof StringValue){if(arg.getValue()instanceof IntValue){var idx=Number(arg.getJSValue());var l=arg.getJSValue().length;if(idx<0)idx+=l;if(idx>=0&&idx<l)v=new StringValue(v.getJSValue().charAt(idx),loc);else throw new RuntimeError(loc.first_line,"文字列の範囲を超えています")}else if(arg.getValue()instanceof SliceValue){var idx1=Number(arg.getValue1().getJSValue());var idx2=Number(arg.getValue2().getJSValue());var l=arg.getJSValue().length;if(!idx1)idx1=0;if(!idx2)idx2=l;if(idx1<0)idx1+=l;if(idx2<0)idx2+=l;if(idx1>=0&&idx2>=0&&idx1<l&&idx2<=l)v=new StringValue(v.getJSValue().substring(idx1,idx2),loc);else throw new RuntimeError(loc.first_line,"文字列の範囲を超えています")}}else throw new RuntimeError(loc.first_line,"添字が使える型ではありません")}var arg=args[args.length-1];if(v.getValue()instanceof ArrayValue){if(arg.getValue()instanceof IntValue){var idx=Number(arg.getJSValue());var l=v.getValue().valueLength();if(idx<0)idx+=l;if(idx>=0&&idx<l){v.getValue().setValue(newval,idx)}else throw new RuntimeError(loc.first_line,"リストの範囲を超えています!")}else throw new RuntimeError(loc.first_line,"リストの添字は整数でなければなりません")}else if(v.getValue()instanceof DictionaryValue){if(isPrimitive(arg.getValue())){v.getValue().setValue(newval,arg)}else throw new RuntimeError(loc.first_line,"辞書の添字は単純型でなければなりません")}else if(v.getValue()instanceof StringValue){if(newval instanceof StringValue){if(arg.getValue()instanceof IntValue){var s=v.getJSValue();var idx=Number(arg.getJSValue());var l=s.length;if(idx<0)idx+=l;if(idx>=0&&idx<l){s=s.substring(0,idx)+newval.getJSValue()+s.substring(idx+1);v=new StringValue([s],loc,s)}else throw new RuntimeError(loc.first_line,"文字列の範囲を超えています")}else if(arg.getValue()instanceof SliceValue){var s=v.getJSValue();var idx1=Number(arg.getValue1().getJSValue());var idx2=Number(arg.getValue2().getJSValue());var l=s.length;if(!idx1)idx1=0;if(!idx2)idx2=l;if(idx1<0)idx1+=l;if(idx2<0)idx2+=l;if(idx1>=0&&idx2>=0&&idx1<l&&idx2<=l){s=s.substring(0,idx1)+newval.getJSValue()+s.substring(idx2);v=new StringValue([s],loc,s)}else throw new RuntimeError(loc.first_line,"文字列の範囲を超えています")}}else throw new RuntimeError(loc.first_line,"文字列に代入できるのは文字列だけです")}else throw new RuntimeError(loc.first_line,"添字が使える型ではありません")}else{vt.vars[vn]=newval}}function getValueByArgs(v,args,loc){v=v.getValue();if(args&&args.length>0){for(var i=0;i<args.length;i++){var arg=args[i];if(v instanceof ArrayValue){if(arg.getValue()instanceof IntValue){var idx=Number(arg.getJSValue());var l=v._value.length;if(idx<0)idx+=l;if(idx>=0&&idx<l)v=v._value[idx].getValue();else throw new RuntimeError(loc.first_line,"リストの範囲を超えてアクセスしました")}else if(arg.getValue()instanceof SliceValue){var idx1=Number(arg.getValue1().getJSValue());var idx2=Number(arg.getValue2().getJSValue());var l=v._value.length;if(!idx1)idx1=0;if(!idx2)idx2=l;if(idx1<0)idx1+=l;if(idx2<0)idx2+=l;if(idx1>=0&&idx2>=0&&idx1<=l&&idx2<=l){var a=[],b=[];for(var j=idx1;j<idx2;j++){a.push(v.getValue(j).clone());b.push(v.getValue(j).getValue())}v=new ArrayValue(a,loc,a)}else throw new RuntimeError(loc.first_line,"リストの範囲を超えました")}else throw new RuntimeError(loc.first_line,"リストの添字は整数かスライスです"+(debug_mode?" (arg type: "+arg.constructor.name+")":""))}else if(v instanceof DictionaryValue){if(isPrimitive(arg)){var key=arg.getJSValue();if(v._value.has(key))v=v._value.get(key).getValue();else throw new RuntimeError(loc.first_line,"辞書にキー"+key+"がありません")}else throw new RuntimeError(loc.first_line,"辞書の添字は基本型です")}else if(v instanceof StringValue){if(arg.getValue()instanceof IntValue){var idx=Number(arg.getJSValue());var l=v.getJSValue().length;if(idx<0)idx+=l;if(idx>=0&&idx<l){var s=v.getJSValue().charAt(idx);v=new StringValue([s],loc,s)}else throw new RuntimeError(loc.first_line,"リストの範囲を超えてアクセスしました")}else if(arg.getValue()instanceof SliceValue){var idx1=Number(arg.getValue1().getJSValue());var idx2=Number(arg.getValue2().getJSValue());var l=v.getJSValue().length;if(!idx1)idx1=0;if(!idx2)idx2=l;if(idx1<0)idx1+=l;if(idx2<0)idx2+=l;if(idx1>=0&&idx2>=0&&idx1<=l&&idx2<=l){var s=v.getJSValue().substring(idx1,idx2);v=new StringValue([s],loc,s)}else throw new RuntimeError(loc.first_line,"リストの範囲を超えました")}else throw new RuntimeError(loc.first_line,"文字列の添字は整数かスライスです")}}}return v}function setCaller(statementlist,caller){for(let i=0;i<statementlist.length;i++){if(statementlist[i].statementlist)setCaller(statementlist[i].statementlist,caller);if(statementlist[i].state)setCaller(statementlist[i].state,caller);if(statementlist[i].blocks){for(var j=0;j<statementlist[i].blocks.length;j++)setCaller(statementlist[i].blocks[j][1],caller)}if(statementlist[i]instanceof ReturnStatement)statementlist[i].setCaller(caller,true)}}function cloneStatementlist(statementlist){var rtnv=[];for(let i=0;i<statementlist.length;i++)if(statementlist[i])rtnv.push(statementlist[i].clone());return rtnv}function argsPyPEN(v){if(v instanceof Value)return v.argsPyPEN();else if(v instanceof Array){let ag=[];for(let i=0;i<v.length;i++)ag.push(argsPyPEN(v[i]));return"["+ag.join(", ")+"]"}else if(v instanceof Map){let ag=[];for(let[key,value]of v)ag.push(key+": "+argsPyPEN(value));return"{"+ag.join(", ")+"}"}else return v+""}function argsPython(v){if(v instanceof Value)return v.argsPython();else if(v instanceof Array){let ag=[];for(let i=0;i<v.length;i++)ag.push(argsPython(v[i]));return"["+ag.join(", ")+"]"}else if(v instanceof Map){let ag=[];for(let[key,value]of v)ag.push(key+": "+argsPython(value));return"{"+ag.join(", ")+"}"}else return v+""}function valueString(v){if(v instanceof Value)return v.valueString();else if(v instanceof Array){let ag=[];for(let i=0;i<v.length;i++)ag.push(valueString(v[i]));return"["+ag.join(", ")+"]"}else if(v instanceof Map){let ag=[];for(let[key,value]of v){if(typeof key==="string")key="'"+key+"'";ag.push(key+":"+valueString(value))}return"{"+ag.join(", ")+"}"}else return v+""}function valueCode(v){if(v instanceof Value)return v.valueCode();else if(v instanceof Array){let ag=[];for(let i=0;i<v.length;i++)ag.push(valueCode(v[i]));return"["+ag.join(", ")+"]"}else if(v instanceof Map){let ag=[];for(let[key,value]of v)ag.push(key+": "+valueCode(value));return"{"+ag.join(", ")+"}"}else return v+""}class Statement{constructor(loc){this._loc=loc;this.state=0;if(!(this._loc instanceof Location))throw new Error("StatementのlocがLocationではありません"+constructor_name(this))}get first_line(){return this._loc.first_line}get last_line(){return this._loc.last_line}get loc(){return this._loc}getLoc(){return this._loc}run(){throw new RuntimeError(this.first_line,"これを呼んではいけない")}argsPython(indent){return makeIndent(indent)}clone(){throw new RuntimeError(this.first_line,constructor_name(this)+"はcloneが作られていません")}}class ExitStatement extends Statement{constructor(loc){super(loc)}clone(){return new ExitStatement(this.loc)}run(){if(code[0]instanceof parsedFunction){code.shift();varTables.shift()}else throw new RuntimeError(this.first_line,"手続きの中ではありません")}argsPython(indent){var code=makeIndent(indent);code+="break";return code}}class DefineFunction extends Statement{constructor(funcName,params,statementlist,loc){super(loc);if(definedFunction[funcName])throw new RuntimeError(this.first_line,"関数 "+funcName+" と同名の標準関数が存在します");if(myFuncs[funcName])throw new RuntimeError(this.first_line,"関数 "+funcName+" と同名の関数、または手続きが既に定義されています");this.params=params;this.funcName=funcName;myFuncs[funcName]=this;this.statementlist=statementlist}clone(){throw new RuntimeError(this.first_line,"これはクローンされるべきでない")}run(){code[0].stack[0].index++}argsPython(indent){var code="def ";code+=this.funcName+"(";for(var i=0;i<this.params.length;i++){if(i>0)code+=", ";code+=this.params[i].argsPython(indent)}code+="):";code=[code];var codes=0;for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i]){codes=1;code.push(this.statementlist[i].argsPython(indent+1))}if(codes==0)code.push(makeIndent(1)+"pass");return code.join("\n")}}class ReturnStatement extends Statement{constructor(value,loc){super(loc);this.value=value.clone();this.caller=null;this.flag=false;this.state=0}clone(){let rtnv=new ReturnStatement(this.value.clone(),this.loc);rtnv.caller=this.caller;rtnv.flag=this.flag;return rtnv}setCaller(caller,flag){this.caller=caller;this.flag=flag}run(){if(this.state==0){code[0].stack.unshift({statementlist:[this.value],index:0});this.state=1}else{code[0].stack[0].index++;if(code[0]instanceof parsedFunction){this.caller.setValue(this.value);code.shift();if(this.flag)varTables.shift()}else throw new RuntimeError(this.first_line,"関数の中ではありません");this.state=0}}argsPython(indent){var code=makeIndent(indent);code+="return";if(this.value)code+=" "+this.value.argsPython();return code}}function dump(message=null){if(!message)message="*** 変数確認 ***";textareaAppend(message+"\n");var vars=varTables[0].varnames([]);if(varTables.length>1)vars=varTables[varTables.length-1].varnames(vars);for(var i=0;i<vars.length;i++){if(vars[i][0]=="!")continue;let vartable=findVarTable(vars[i]);let v=vartable.vars[vars[i]];textareaAppend(vars[i]+":"+valueString(v)+"\n")}}class DumpStatement extends Statement{constructor(loc){super(loc)}clone(){return new DumpStatement(this.loc)}run(){dump();code[0].stack[0].index++}argsPython(){return""}}function argsString(args){if(args instanceof ArrayValue){let a=[];for(let i=0;i<args.value.length;i++)a.push(args.value[i].getValue().value);return"["+a.join(",")+"]"}return""}function SameSignBigInt(a,b){return a>=0&&b>=0||a<0&&b<0}class Append extends Statement{constructor(variable,value,loc){super(loc);if(!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"追加されるものは変数でなくてはいけません");this.variable=variable;this.value=value;this.state=0}clone(){return new Append(this.variable.clone(),this.value.clone(),this.loc)}run(){if(this.state==0){code[0].stack.unshift({statementlist:[this.variable,this.value],index:0});this.state=1}else{if(!(this.variable.getValue()instanceof ArrayValue&&this.value.getValue()instanceof Value))throw new RuntimeError(this.first_line,"追加される値はリストです");code[0].stack[0].index++;this.variable.getValue().append(this.value.getValue());this.state=0}}argsPython(indent){var code=makeIndent(indent);code+=this.variable.argsPython()+".push("+this.value.argsPython()+")";return code}}class Extend extends Statement{constructor(variable,value,loc){super(loc);if(!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"連結されるものは変数でなくてはいけません");this.variable=variable;this.value=value;this.state=0}clone(){return new Extend(this.variable.clone(),this.value.clone(),this.loc)}run(){if(this.state==0){code[0].stack.unshift({statementlist:[this.variable,this.value],index:0});this.state=1}else{if(!(this.variable.getValue()instanceof ArrayValue&&this.value.getValue()instanceof ArrayValue))throw new RuntimeError(this.first_line,"リストどうしでないと連結できません");code[0].stack[0].index++;var a=[];for(var i of this.value.getValue()._value)a.push(i.getValue());this.variable.getValue().extend(a);this.state=0}}argsPython(indent){var code=makeIndent(indent);code+=this.variable.argsPython()+".extend("+this.value.argsPython()+")";return code}}class Input extends Statement{constructor(x,type,loc){super(loc);if(!(x instanceof Variable||x instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"入力されるものは変数でなくてはいけません");this.variable=x;this.type=type;this.state=0}clone(){return new Input(this.variable.clone(),this.type,this.loc)}run(){if(selected_quiz<0){code[0].stack[0].index++;if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");var list=[new InputBegin(this.loc),new InputEnd(this.variable,this.type,this.loc)];code[0].stack.unshift({statementlist:list,index:0})}else{if(this.state==0){if(this.variable.args)code[0].stack.unshift({statementlist:this.variable.args,index:0});this.state=1}else{code[0].stack[0].index++;if(selected_quiz_input<Quizzes[selected_quiz].inputs(selected_quiz_case).length){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let va=new Variable(this.variable.varname,this.loc);let vl=Quizzes[selected_quiz].inputs(selected_quiz_case)[selected_quiz_input++];var v=null;if(this.type==typeOfValue.typeInt){var v0=BigInt(toHalf(vl,this.loc));v=new IntValue([v0],this.loc,v0)}else if(this.type==typeOfValue.typeFloat){var v0=Number(toHalf(vl,this.loc));v=new FloatValue([v0],this.loc,v0)}else if(this.type==typeOfValue.typeString){var v0=vl+"";v=new StringValue([v0],this.loc,v0)}else if(this.type==typeOfValue.typeBoolean){var v0=toBool(vl);v=new BooleanValue([v0],this.loc,v0)}if(v!==null){var assign=new Assign(this.variable,v,null,this.loc);code[0].stack.unshift({statementlist:[assign],index:0})}else throw new RuntimeError(this.first_line,"不明な型です。")}else throw new RuntimeError(this.first_line,"必要以上の入力を求めています。");this.state=0}}}argsPython(indent){var code=makeIndent(indent);code+=this.variable.argsPython()+" = ";switch(this.type){case typeOfValue.typeInt:code+="int(input())";break;case typeOfValue.typeFloat:code+="float(input())";break;case typeOfValue.typeString:code+="input()";break;case typeOfValue.typeBoolean:code+="bool(input())";break}return code}}function openInputWindow(){setRunflag(false);setEditableflag(false);var input_area=document.getElementById("input_area");input_area.value="";input_area.readOnly=false;input_area.focus();document.getElementById("input_status").style.visibility="visible";document.getElementById("sourceTextarea").readOnly=true;editor.options.readOnly=true;editor.getWrapperElement().classList.add("readonly")}function closeInputWindow(){var val=document.getElementById("input_area").value;document.getElementById("input_area").readOnly=true;document.getElementById("input_status").style.visibility="hidden";return val}function keydownInput(e){var evt=e||window.event;if(evt.keyCode==13){setRunflag(true);step()}else if(evt.keyCode==27){closeInputWindow();code.shift()}}class InputBegin extends Statement{constructor(loc){super(loc)}clone(){return new InputBegin(this.loc)}run(){openInputWindow();code[0].stack[0].index++}}class InputEnd extends Statement{constructor(x,type,loc){super(loc);this.varname=x;this.type=type;this.state=0}clone(){return new InputEnd(this.varname.clone(),this.type,this.loc)}run(){if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");if(this.state==0){if(this.varname.args)code[0].stack.unshift({statementlist:this.varname.args,index:0});this.state=1}else{code[0].stack[0].index++;try{let vl=closeInputWindow();let assign=null;let re=/^(0+|false|偽|)$/i;if(this.type==typeOfValue.typeInt)assign=new Assign(this.varname,new IntValue([toHalf(vl,this.loc)],this.loc,toHalf(vl,this.loc),null,this.loc));else if(this.type==typeOfValue.typeFloat)assign=new Assign(this.varname,new FloatValue([Number(toHalf(vl,this.loc))],this.loc,Number(toHalf(vl,this.loc))),null,this.loc);else if(this.type==typeOfValue.typeString)assign=new Assign(this.varname,new StringValue([vl+""],this.loc,vl+""),null,this.loc);else if(this.type==typeOfValue.typeBoolean)assign=new Assign(this.varname,new BooleanValue([toBool(vl)],this.loc,toBool(vl)),null,this.loc);code[0].stack.unshift({statementlist:[assign],index:0})}catch(e){closeInputWindow();throw e}this.state=0}}}class Newline extends Statement{constructor(loc){super(loc)}clone(){return new Newline(this.loc)}run(){code[0].stack[0].index++;if(selected_quiz<0){textareaAppend("\n")}else{output_str+="\n"}}argsPython(indent){return makeIndent(indent)+"print()"}}function array2text(v,flag=false){if(!v)return"";if(v instanceof Value){if(v instanceof ArrayValue){let v1=[];for(let i=0;i<v.length;i++){var tmp=v._value[i];v1.push(array2text(tmp,flag))}return"["+v1.join(",")+"]"}else if(v instanceof DictionaryValue){let v1=[];let keys=v.getValue().keys();for(let key of keys){var val=v.getValue(key);if(typeof key==="string")key="'"+key+"'";v1.push(key+":"+array2text(val,flag))}return"{"+v1.join(",")+"}"}else if(v instanceof BooleanValue)return v.getValue()?"True":"False";else if(v instanceof FloatValue&&isInteger(v.getValue())&&!v.getValue().toString().match(/[Ee]/))return v.getValue()+".0";else if(flag&&v instanceof StringValue)return new String("'"+v.getValue()+"'");else return v.getValue()}else return new String(v)}function array2code(v,flag=false){if(!v)return"";if(v instanceof ArrayValue){let v1=[];for(let i=0;i<v.length;i++)v1.push(array2text(v.getValue(i).getCode(),flag));return"["+v1.join(",")+"]"}else if(v instanceof DictionaryValue){let v1=[];let keys=v.getValue().keys();for(let key of keys){var val=v.getValue().get(key);if(typeof key==="string")key="'"+key+"'";v1.push(key+":"+array2text(val.value,flag))}return"{"+v1.join(",")+"}"}else if(flag&&v instanceof StringValue)return"'"+v.getValue()+"'";else if(v instanceof FloatValue&&isInteger(v.getValue())&&!v.getValue().toString().match(/[Ee]/))return v.getValue()+".0";return v.getValue().toString()}function val2obj(val){if(val instanceof ArrayValue){var rtnv=[];var l=val.getValue().value.length;for(var i=0;i<l;i++)rtnv.push(val2obj(val.getValue().value[i]));return rtnv}else if(val instanceof DictionaryValue){var rtnv={};for(var key of val.getValue().value.keys())rtnv[key]=val2obj(val.getValue().value.get(key).getValue());return rtnv}else if(val instanceof IntValue)return Number(val.rtnv);else return val.rtnv}function array2values(a,loc){var rtnv=[];var array=null;if(a.rtnv instanceof ArrayValue){if(a.rtnv.value[0]instanceof ArrayValue)array=a.rtnv;else if(a.rtnv.value instanceof Array)array=new ArrayValue([a.rtnv.value],loc);else throw new RuntimeError(loc.first_line,"グラフに誤った型が使われています")}else if(a.rtnv instanceof Array)array=new ArrayValue(a.rtnv,loc);else throw new RuntimeError(loc.first_line,"棒グラフ・線グラフには配列が必要です");for(var i=0;i<array.length;i++){var rtnv1=[];for(var j=0;j<array.value[i].length;j++){var val=array.value[i]instanceof ArrayValue?array.value[i].value[j]:array.value[i][j];if(val instanceof IntValue)rtnv1.push(Number(val.getValue()));else rtnv1.push(val.getValue())}rtnv.push(rtnv1)}return rtnv}class Output extends Statement{constructor(x,ln,loc){super(loc);this.value=x;this.ln=ln;this.state=0}clone(){var val=[];for(var i=0;i<this.value.length;i++)val.push(this.value[i].clone());return new Output(val,this.ln,this.loc)}run(){if(this.state==0){code[0].stack.unshift({statementlist:this.value,index:0});this.state=1}else{code[0].stack[0].index++;let s="";for(var i=0;i<this.value.length;i++){s+=(i>0?" ":"")+valueString(this.value[i].getValue())}if(this.ln)s+="\n";if(selected_quiz<0)textareaAppend(s);else output_str+=s;this.state=0}}argsPython(indent){var code=makeIndent(indent);code+="print(";for(var i=0;i<this.value.length;i++)code+=(i>0?", ":"")+this.value[i].argsPython();if(!this.ln)code+=",end=''";return code+")"}}class If extends Statement{constructor(blocks,loc){super(loc);this.blocks=blocks;this.running=-1}clone(){var newblock=[];for(var i=0;i<this.blocks.length;i++){var newblock1=[];for(var j=0;j<this.blocks[i][1].length;j++)if(this.blocks[i][1][j])newblock1.push(this.blocks[i][1][j].clone());newblock.push([this.blocks[i][0]?this.blocks[i][0].clone():null,newblock1])}return new If(newblock,this.loc)}run(){if(this.state==0){this.running=0;this.state=1}else if(this.state==1){if(this.running<this.blocks.length){if(this.blocks[this.running]&&this.blocks[this.running][0])code[0].stack.unshift({statementlist:[this.blocks[this.running][0]],index:0});this.state=2}else{this.state=0;code[0].stack[0].index++}}else if(this.state==2){var flag=this.blocks[this.running][0]?this.blocks[this.running][0].getValue().getJSValue():true;if(flag){code[0].stack[0].index++;this.state=0;code[0].stack.unshift({statementlist:this.blocks[this.running][1],index:0})}else{this.running++;this.state=1}}}argsPython(indent){var code=[];for(var i=0;i<this.blocks.length;i++){if(i==0)code.push(makeIndent(indent)+"if "+this.blocks[i][0].argsPython()+":");else if(this.blocks[i][0])code.push(makeIndent(indent)+"elif "+this.blocks[i][0].argsPython(0)+":");else code.push(makeIndent(indent)+"else:");if(this.blocks[i][1]&&this.blocks[i][1].length>0){for(var j=0;j<this.blocks[i][1].length;j++)code.push(this.blocks[i][1][j].argsPython(indent+1))}else code.push(makeIndent(indent+1)+"pass")}return code.join("\n")}}class LoopBegin extends Statement{constructor(condition,continuous,loc){super(loc);this.condition=condition;this.continuous=continuous;this.state=0}clone(){return new LoopBegin(this.condition?this.condition.clone():null,this.continuous,this.loc)}run(){if(this.state==0){if(this.condition)code[0].stack.unshift({statementlist:[this.condition],index:0});this.state=1}else{if(!this.condition||toBool(this.condition.getJSValue())==this.continuous)code[0].stack[0].index++;else code[0].stack[0].index=-1;this.state=0}}}class LoopEnd extends Statement{constructor(condition,continuous,loc){super(loc);this.condition=condition;this.continuous=continuous;this.state=0}clone(){return new LoopEnd(this.condition?this.condition.clone():null,this.continuous,this.loc)}run(){if(this.state==0){if(this.condition)code[0].stack.unshift({statementlist:[this.condition],index:0});this.state=1}else{if(!this.condition||toBool(this.condition.getJSValue())==this.continuous)code[0].stack[0].index=0;else code[0].stack[0].index=-1;this.state=0}}}class LoopBody extends Statement{constructor(statementlist,loc){super(loc);this.statementlist=statementlist}clone(){var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());return new LoopBody(state,this.loc)}run(){code[0].stack[0].index++;var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());code[0].stack.unshift({statementlist:state,index:0})}}class ForIn extends Statement{constructor(array,variable,statementlist,loc){super(loc);if(!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"繰り返しのカウンタは変数でなくてはいけません");this.array=array;this.variable=variable;this.statementlist=[];for(var statement of statementlist)this.statementlist.push(statement.clone())}clone(){var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());return new ForIn(this.array.clone(),this.variable.clone(),state,this.loc)}argsPython(indent){var code=[makeIndent(indent)];var pa=this.array.argsPython(),pv=this.variable.argsPython();code.push("for "+pv+" in "+pa+":");var codes=0;for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i]){codes=1;code.push(this.statementlist[i].argsPython(indent+1))}if(codes==0)code.push(makeIndent(indent+1)+"pass");return code.join("\n")}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.loc.first_line,"未完成のプログラムです");if(this.state==0){code[0].stack.unshift({statementlist:[this.array],index:0});this.state=1}else{code[0].stack[0].index++;let loop=[new ForIn_step(this,this.variable,this.array._value,this.loc),new LoopBegin(new BooleanValue([true],this.loc,true),true,this.loc)];loop.push(new LoopBody(this.statementlist,this.loc));loop.push(new LoopEnd(null,true,this.loc));code[0].stack.unshift({statementlist:loop,index:0});this.state=0}}}class ForIn_step extends Statement{constructor(forin,variable,array,loc){super(loc);this.forin=forin;this.variable=variable;this.array=array;this.index=0}clone(){return new ForIn_step(this.forin.clone(),this.variable.clone(),this.array.clone(),this.loc)}run(){code[0].stack[0].index++;if(this.index<this.array.length){let assign=new Assign(this.variable,this.array[this.index++],null,this.loc);code[0].stack.unshift({statementlist:[assign],index:0})}else{code[0].stack[0].statementlist[1]=new LoopBegin(new BooleanValue([false],this.loc,false),true,this.loc)}}}class ForInc extends Statement{constructor(variable,begin,end,step,statementlist,loc){super(loc);if(!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"繰り返しのカウンタは変数でなくてはいけません");this.variable=variable;this.begin=begin;this.end=end;this.step=step;this.statementlist=statementlist;this.state=0}clone(){var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());return new ForInc(this.variable.clone(),this.begin.clone(),this.end.clone(),this.step.clone(),state,this.loc)}argsPython(indent){var code=[];var pv=this.variable.argsPython(),pb=this.begin.argsPython(),pe=this.end.argsPython(),ps=this.step.argsPython();code.push(makeIndent(indent)+"for "+pv+" in range("+pb+", "+pe+"+1, "+ps+")");var codes=0;for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i]){codes=1;code.push(this.statementlist[i].argsPython(indent+1))}if(codes==0)code.push(makeIndent(indent+1)+"pass");return code.join("\n")}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");if(this.state==0){code[0].stack.unshift({statementlist:[new Assign(this.variable,this.begin,null,this.loc)],index:0});code[0].stack.unshift({statementlist:[this.begin,this.end,this.step],index:0});this.state=1}else{code[0].stack[0].index++;if(this.step.getJSValue()<=0)throw new RuntimeError(this.first_line,"増分は0より大きい値である必要があります");if(this.begin.getValue()instanceof IntValue||this.begin.getValue()instanceof FloatValue){let condition=new Compare([this.variable,"<=",this.end],this.loc);let loop=[this.variable,condition,new LoopBegin(condition,true,this.loc)];loop.push(new LoopBody(this.statementlist,this.loc));loop.push(this.step);loop.push(new Assign(this.variable,this.step,"+",this.loc));loop.push(new LoopEnd(null,true,this.loc));code[0].stack.unshift({statementlist:loop,index:0})}else throw new RuntimeError(this.first_line,"初期値は数値型である必要があります");this.state=0}}}class ForDec extends Statement{constructor(variable,begin,end,step,statementlist,loc){super(loc);if(!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"繰り返しのカウンタは変数でなくてはいけません");this.variable=variable;this.begin=begin;this.end=end;this.step=step;this.statementlist=statementlist;this.state=0}clone(){var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());return new ForDec(this.variable.clone(),this.begin.clone(),this.end.clone(),this.step.clone(),state,this.loc)}argsPython(indent){var code=[];var pv=this.variable.argsPython(),pb=this.begin.argsPython(),pe=this.end.argsPython(),ps=this.step.argsPython();code.push(makeIndent(indent)+"for "+pv+" in range("+pb+", "+pe+"-1, "+ps+"):");var codes=0;for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i]){codes=1;code.push(this.statementlist[i].argsPython(indent+1))}if(codes==0)code.push(makeIndent(indent+1)+"pass");return code.join("\n")}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");if(this.state==0){code[0].stack.unshift({statementlist:[new Assign(this.variable,this.begin,null,this.loc)],index:0});code[0].stack.unshift({statementlist:[this.begin,this.end,this.step],index:0});this.state=1}else{code[0].stack[0].index++;if(this.step.getJSValue()<=0)throw new RuntimeError(this.first_line,"減分は0より大きい値である必要があります");if(this.begin.getValue()instanceof IntValue||this.begin.getValue()instanceof FloatValue){let condition=new Compare([this.variable,">=",this.end],this.loc);let loop=[this.variable,condition,new LoopBegin(condition,true,this.loc)];loop.push(new LoopBody(this.statementlist,this.loc));loop.push(this.step);loop.push(new Assign(this.variable,this.step,"-",this.loc));loop.push(new LoopEnd(null,true,this.loc));code[0].stack.unshift({statementlist:loop,index:0})}else throw new RuntimeError(this.first_line,"初期値は数値型である必要があります");this.state=0}}}class While extends Statement{constructor(condition,statementlist,loc){super(loc);this.condition=condition;this.statementlist=statementlist;this.status=0}clone(){var state=[];for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i])state.push(this.statementlist[i].clone());return new While(this.condition.clone(),state,this.loc)}argsPython(indent){var code=[];code.push(makeIndent(indent)+"while "+this.condition.argsPython()+":");var codes=0;for(var i=0;i<this.statementlist.length;i++)if(this.statementlist[i]){codes=1;code.push(this.statementlist[i].argsPython(indent+1))}if(codes==0)code.push(makeIndent(indent+1)+"pass");return code.join("\n")}run(){if(this.status==0){code[0].stack.unshift({statementlist:[this.condition],index:0});this.status=1}else{code[0].stack[0].index++;let loop=[new LoopBegin(this.condition,true,this.loc)];loop.push(new LoopBody(this.statementlist,this.loc));loop.push(new LoopEnd(null,false,this.loc));code[0].stack.unshift({statementlist:loop,index:0});this.status=0}}}class SleepStatement extends Statement{constructor(sec,loc){super(loc);this.sec=new IntValue(sec.value,loc)}clone(){return new SleepStatement(this.sec.clone(),this.loc)}run(){wait_time=this.sec.getJSValue();code[0].stack[0].index++}argsPython(indent){var code=makeIndent(indent);python_lib["time"]=1;return code+"time.sleep("+this.sec.argsPython()+" / 1000)"}}class NopStatement extends Statement{constructor(loc){super(loc)}clone(){return new NopStatement(this.loc)}run(){code[0].stack[0].index++}argsPython(indent){return makeIndent(indent)+"pass"}}class PauseStatement extends Statement{constructor(loc){super(loc)}clone(){return new PauseStatement(this.loc)}run(){code[0].stack[0].index++}argsPython(indent){return""}}class BreakStatement extends Statement{constructor(loc){super(loc)}clone(){return new BreakStatement(this.loc)}run(){while(true){var block=code[0].stack.shift();if(!block)throw new RuntimeError(this.first_line,"繰り返しの中ではありません。");for(var i=0;i<block.statementlist.length;i++)if(block.statementlist[i]instanceof LoopBegin)return}}argsPython(indent){return makeIndent(indent)+"break"}}class DefinedFunction{constructor(argc,func,module,convert){this.argc=argc;this.func=func;this.module=module;this.convert=convert;this.caller=null;this.loc=null;this.state=0}run(){if(this.argc instanceof Array&&this.argc[0]<=this.parameters.length&&this.argc[1]>=this.parameters.length||this.parameters.length==this.argc||this.argc<0){code[0].stack[0].index++;this.caller.setValue(this.func(this.parameters,this.loc));code.shift()}else throw new RuntimeError(this.loc.first_line,"引数の個数が違います")}clone(){return new DefinedFunction(this.argc,this.func,this.module,this.convert)}setCaller(caller){this.caller=caller}setParameter(params){this.parameters=params}setLocation(loc){this.loc=loc}throwRuntimeError(funcname,message){throw new RuntimeError(this.loc.first_line,funcname+": "+message)}}var definedFunction={match:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(!(par1 instanceof StringValue)||!(par2 instanceof StringValue))this.throwRuntimeError("match","matchの引数は文字列です");var re=RegExp(par1.getJSValue());var result=re.exec(par2.getJSValue());if(result){var a=[];for(let i=0;i<result.length;i++)a.push(new StringValue([result[i]],loc,result[i]));return new ArrayValue(a,loc,a)}return new ArrayValue([],loc,[])},null,function(argc){return"re.match("+argc[0]+", "+argc[1]+").groups()"}),search:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(!(par1 instanceof StringValue)||!(par2 instanceof StringValue))this.throwRuntimeError("search","searchの引数は文字列です");var re=RegExp(par1.getJSValue(),"g");var result=par2.getJSValue().match(re);if(result){var a=[];for(let i=0;i<result.length;i++)a.push(new StringValue([result[i]],loc,result[i]));return new ArrayValue(a,loc,a)}return new ArrayValue([],loc,[])},null,function(argc){return"re.search("+argc[0]+", "+argc[1]+").groups()"}),typeis:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();var result=false;if(!(par2 instanceof StringValue))this.throwRuntimeError("typeis","typeisの第2引数は文字列にしてください");var s=par2.getJSValue();if(par1 instanceof IntValue)result=s.match(/^整数|int|integer$/i);else if(par1 instanceof FloatValue)result=s.match(/^実数|float|double$/i);else if(par1 instanceof StringValue)result=s.match(/^文字列|string$/i);else if(par1 instanceof BooleanValue)result=s.match(/^真偽|bool|boolean$/i);else if(par1 instanceof ArrayValue)result=s.match(/^(リスト|list|array)$/i);else if(par1 instanceof DictionaryValue)result=s.match(/^辞書|dictionary|dict$/i);else if(par1 instanceof NullValue)result=false;else this.throwRuntimeError("typeis","不明な型です"+constructor_name(par1));return new BooleanValue([result],loc,result)},null,function(argc){return"isinstance("+argc[0]+", "+argc[1]+")"}),typeof:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return new StringValue(["整数"],loc,"整数");else if(par1 instanceof FloatValue)return new StringValue(["実数"],loc,"実数");else if(par1 instanceof StringValue)return new StringValue(["文字列"],loc,"文字列");else if(par1 instanceof BooleanValue)return new StringValue(["真偽"],loc,"真偽");else if(par1 instanceof ArrayValue)return new StringValue(["リスト"],loc,"リスト");else if(par1 instanceof DictionaryValue)return new StringValue(["辞書"],loc,"辞書");else if(par1 instanceof NullValue)return new StringValue([""],loc,"");else this.throwRuntimeError("typeof","不明な型です")},null,function(argc){return"type("+argc[0]+")"}),range:new DefinedFunction([1,3],function(param,loc){var par1=BigInt(0),par2,par3=BigInt(1);if(param.length==1){par2=param[0].getJSValue()}else if(param.length==2){par1=param[0].getJSValue();par2=param[1].getJSValue()}else{par1=param[0].getJSValue();par2=param[1].getJSValue();par3=param[2].getJSValue()}var args=[];if(par3==0)this.throwRuntimeError("range","rangeのステップに0は指定できません");if(typeof par1=="bigint"&&typeof par2=="bigint"&&typeof par3=="bigint"){if(par3>0){for(let i=par1;i<par2;i+=par3)args.push(new IntValue([i],loc,i))}else{for(let i=par1;i>par2;i+=par3)args.push(new IntValue([i],loc,i))}return new ArrayValue(args,loc,args)}else this.throwRuntimeError("range","rangeの引数は整数にしてください")},null,null),keys:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof DictionaryValue){var args=[];for(let key of par1._value.keys()){switch(typeof key){case"number":args.push(new FloatValue([key],loc,key));break;case"bigint":args.push(new IntValue([key],loc,key));break;case"boolean":args.push(new BooleanValue([key],loc,key));break;case"string":args.push(new StringValue([key],loc,key));break;default:this.throwRuntimeError("keys","辞書のキーの型が不正です")}}return new ArrayValue(args,loc,args)}else this.throwRuntimeError("keys","keysは辞書にしか使えません")},null,null),abs:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();textareaAppend("abs FloatValue:"+par1.getJSValue()+"\n");if(par1 instanceof IntValue){var v=par1.getJSValue();if(v<0)v=-v;return new IntValue([v],loc,v)}else if(par1 instanceof FloatValue){var v=par1.getJSValue();if(v<0)v=-v;return new FloatValue([v],loc,v)}else this.throwRuntimeError("abs","absは数値にしか使えません")},null,null),random:new DefinedFunction([0,1],function(param,loc){if(param.length==0){var v=Math.random();return new FloatValue([v],loc,v)}else{var par1=param[0].getValue();if(par1 instanceof IntValue){var v=Math.floor(Math.random()*(Number(par1.getJSValue())+1));return new IntValue([v],loc,v)}else this.throwRuntimeError("random","randomは引数なしか，整数の引数をとります")}},"random",function(argc){if(argc[0])return"random.randint(0,"+argc[0]+")";else return"random.random()"}),ceil:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;else if(par1 instanceof FloatValue){var v=Math.ceil(par1.getJSValue());if(isSafeInteger(v))return new IntValue([v],loc,v)}else this.throwRuntimeError("ceil","ceilは数値にしか使えません")},"math",null),floor:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;else if(par1 instanceof FloatValue){var v=Math.floor(par1.getJSValue());if(isSafeInteger(v))return new IntValue([v],loc,v)}else this.throwRuntimeError("floor","floorは数値にしか使えません")},"math",null),round:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;else if(par1 instanceof FloatValue){var v=Math.round(par1.getJSValue());if(isSafeInteger(v))return new IntValue([v],loc,v)}else this.throwRuntimeError("round","roundは数値にしか使えません")},null,null),sin:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){var v=Math.sin(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}else this.throwRuntimeError("sin","sinは数値にしか使えません")},"math",null),cos:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){var v=Math.cos(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}else this.throwRuntimeError("cos","cosは数値にしか使えません")},"math",null),tan:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){let v=Math.tan(Number(par1.getJSValue()));if(isFinite(v))return new FloatValue([v],loc,v);else this.throwRuntimeError("tan","オーバーフローしました")}else this.throwRuntimeError("tan","tanは数値にしか使えません")},"math",null),asin:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(Number(par1.getJSValue())>1||Number(par1.getJSValue())<-1)this.throwRuntimeError("asin","asinの定義域外の値が使われました");else{var v=Math.asin(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}}else this.throwRuntimeError("asin","asinは数値にしか使えません")},"math",null),acos:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(Number(par1.getJSValue())>1||Number(par1.getJSValue())<-1)this.throwRuntimeError("acos","acosの定義域外の値が使われました");else{var v=Math.acos(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}}else this.throwRuntimeError("acos","acosは数値にしか使えません")},"math",null),atan:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){var v=Math.atan(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}else this.throwRuntimeError("atan","atanは数値にしか使えません")},"math",null),atan2:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if((par1 instanceof IntValue||par1 instanceof FloatValue)&&(par2 instanceof IntValue||par2 instanceof FloatValue)){var v=Math.atan2(Number(par1.getJSValue()),Number(par2.getJSValue()));return new FloatValue([v],loc,v)}else this.throwRuntimeError("atan2","atan2は数値にしか使えません")},"math",null),sqrt:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(Number(par1.getJSValue())<0)this.throwRuntimeError("sqrt","負の数のルートを求めようとしました");var v=Math.sqrt(Number(par1.getJSValue()));return new FloatValue([v],loc,v)}else this.throwRuntimeError("sqrt","sqrtは数値にしか使えません")},"math",null),log:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(Number(par1.getJSValue())<=0)this.throwRuntimeError("log","正でない数の対数を求めようとしました");let v=Math.log(Number(par1.getJSValue()));if(isFinite(v))return new FloatValue([v],loc,v);this.throwRuntimeError("log","オーバーフローしました")}else this.throwRuntimeError("log","logは数値にしか使えません")},"math",null),exp:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){let v=Math.exp(Number(par1.getJSValue()));if(isFinite(v))return new FloatValue([v],loc,v);this.throwRuntimeError("exp","オーバーフローしました")}else this.throwRuntimeError("exp","expは数値にしか使えません")},"math",null),pow:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof IntValue&&par2 instanceof IntValue){if(par1.getJSValue()==0&&par2.getJSValue()<=0)this.throwRuntimeError("pow","0は正の数乗しかできません");var v=par1.getJSValue()**par2.getJSValue();return par2.getJSValue()>=0?new IntValue([v],loc,v):new FloatValue([v],loc,v)}else if((par1 instanceof IntValue||par1 instanceof FloatValue)&&(par2 instanceof IntValue||par2 instanceof FloatValue)){par1=Number(par1.getJSValue());par2=Number(par2.getJSValue());if(par1<0&&!Number.isInteger(par2))this.throwRuntimeError("pow","負の数の非整数乗はできません");if(par1==0&&par2<=0)this.throwRuntimeError("pow","0は正の数乗しかできません");let v=par1**par2;if(isFinite(v))return new FloatValue([v],loc,v);else this.throwRuntimeError("pow","オーバーフローしました")}else this.throwRuntimeError("pow","powは数値にしか使えません")},null,null),length:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof StringValue){var v=par1.getJSValue().length;return new IntValue([v],loc,v)}else if(par1 instanceof ArrayValue){var v=par1._value.length;return new IntValue([v],loc,v)}else this.throwRuntimeError("length","lengthは文字列と配列にしか使えません"+(debug_mode?":"+constructor_name(par1):""))},null,function(argc){return"len("+argc[0]+")"}),substring:new DefinedFunction([2,3],function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();var par3=param.length==3?param[2].getValue():null;if(par1 instanceof StringValue&&par2 instanceof IntValue&&(par3==null||par3 instanceof IntValue)){var v;if(par3==null)v=par1.getJSValue().substr(Number(par2.getJSValue()));else v=par1.getJSValue().substr(Number(par2.getJSValue()),Number(par3.getJSValue()));return new StringValue([v],loc,v)}else this.throwRuntimeError("substring","substringの引数の型が違います")},null,function(argc){var code=argc[0]+"["+argc[1]+":";if(argc[2])code+=argc[1]+"+"+argc[2];return code+"]"}),append:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof StringValue&&par2 instanceof StringValue){var v=par1.getJSValue()+par2.getJSValue();return new StringValue([v],loc,v)}else if(par1 instanceof ArrayValue&&par2 instanceof Value){var v=par1._value.slice();v.push(par2);return new ArrayValue(v,loc,v)}else this.throwRuntimeError("append","appendの引数の型が違います")},null,function(argc){return argc[0]+"+"+argc[1]}),split:new DefinedFunction([1,2],function(param,loc){var par1=param[0].getValue();var par2=param.length==2?param[1].getValue():null;if(par1 instanceof StringValue&&(par2 instanceof StringValue||par2==null)){var v1=par1.getJSValue();var v=par2?v1.split(par2.getJSValue()):v1.split("");var vr=[];for(var i=0;i<v.length;i++)vr.push(new StringValue([v[i]],loc,v[i]));return new ArrayValue(vr,loc,vr)}else this.throwRuntimeError("split","splitの引数の型が違います")},null,function(argc){if(argc.length==2)return argc[0]+".split("+argc[1]+")";else return"list("+argc[0]+")"}),extend:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof StringValue&&par2 instanceof StringValue){var v=par1.getJSValue()+par2.getJSValue();return new StringValue([v],loc,v)}else if(par1 instanceof ArrayValue&&par2 instanceof ArrayValue){var v=par1._value.slice();for(var i of par2._value)v.push(i);return new ArrayValue(v,loc,v)}else this.throwRuntimeError("extend","extendの引数の型が違います")},null,function(argc){return argc[0]+".extend("+argc[1]+")"}),extract:new DefinedFunction(3,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();var par3=param[2].getValue();if(par1 instanceof StringValue&&par2 instanceof StringValue&&par3 instanceof IntValue){var v1=par1.getJSValue();var v2=par2.getJSValue();var v3=par3.getJSValue();var v=v1.split(v2);if(v3>=0&&v3<v.length)return new StringValue([v[v3]],loc,v[v3]);else this.throwRuntimeError("extract","番号の値が不正です")}else this.throwRuntimeError("extract","extractの引数の型が違います")},null,function(argc){return argc[0]+".split("+argc[1]+")["+argc[2]+"]"}),insert:new DefinedFunction(3,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();var par3=param[2].getValue();if(par1 instanceof StringValue&&par2 instanceof IntValue&&par3 instanceof StringValue){var v1=par1.getJSValue();var v2=Number(par2.getJSValue());var v3=par3.getJSValue();if(v2<0||v2>v1.length)this.throwRuntimeError("insert","位置の値が不正です");var s1=v1.substr(0,v2);var s2=v1.substr(v2);var s=s1+v3+s2;return new StringValue([s],loc,s)}else this.throwRuntimeError("insert","insertの引数の型が違います")},null,function(argc){return argc[0]+"[:"+argc[1]+"]+"+argc[2]+"+"+argc[0]+"["+argc[1]+":]"}),replace:new DefinedFunction(4,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();var par3=param[2].getValue();var par4=param[3].getValue();if(par1 instanceof StringValue&&par2 instanceof IntValue&&par3 instanceof IntValue&&par4 instanceof StringValue){var v1=par1.getJSValue();var v2=Number(par2.getJSValue());var v3=Number(par3.getJSValue());var v4=par4.getJSValue();if(v2<0||v2>v1.length)this.throwRuntimeError("replace","位置の値が不正です");if(v3<0||v2+v3>v1.length)this.throwRuntimeError("replace","長さの値が不正です");var s1=v1.substr(0,v2);var s2=v1.substr(v2+v3);var s=s1+v4+s2;return new StringValue([s],loc,s)}else this.throwRuntimeError("replace","replaceの引数の型が違います")},null,function(argc){return argc[0]+"[:"+argc[1]+"]+"+argc[3]+"+"+argc[0]+"["+argc[1]+"+"+argc[2]+":]"}),isfile:new DefinedFunction(1,function(param,loc){var par=param[0].getValue();if(par instanceof StringValue){var v=storage.getItem(par.getJSValue())!=null;return new BooleanValue([v],loc,v)}else this.throwRuntimeError("isfile","ファイル名は文字列でなくてはいけません")},null,null),openr:new DefinedFunction(1,function(param,loc){var par=param[0].getValue();if(par instanceof StringValue){var v=filesystem.openr(par.getJSValue());return new IntValue([v],loc,v)}else this.throwRuntimeError("openr","ファイル名は文字列でなくてはいけません")},null,function(argc){return"open("+argc[0]+",'r')"}),openw:new DefinedFunction(1,function(param,loc){var par=param[0].getValue();if(par instanceof StringValue){var v=filesystem.openw(par.getJSValue());return new IntValue([v],loc,v)}else this.throwRuntimeError("openw","ファイル名は文字列でなくてはいけません")},null,function(argc){return"open("+argc[0]+",'w')"}),opena:new DefinedFunction(1,function(param,loc){var par=param[0].getValue();if(par instanceof StringValue){var v=filesystem.opena(par.getJSValue());return new IntValue([v],loc,v)}else this.throwRuntimeError("opena","ファイル名は文字列でなくてはいけません")},null,function(argc){return"open("+argc[0]+",'a')"}),getline:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue){var rtnv=filesystem.read_line(par1.getJSValue());if(rtnv==null)this.throwRuntimeError("getline","ファイル番号が不正です");return new StringValue([rtnv],loc,rtnv)}else this.throwRuntimeError("getline","ファイル番号が必要です")},null,function(argc){return argc[0]+".readline()"}),getchar:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue){var rtnv=filesystem.read_ch(par1.getJSValue());if(rtnv==null)this.throwRuntimeError("getchar","ファイル番号が不正です");return new StringValue([rtnv],loc,rtnv)}else this.throwRuntimeError("getchar","ファイル番号が必要です")},null,function(argc){return argc[0]+".read(1)"}),putline:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof IntValue&&par2 instanceof StringValue){var str=par2.getJSValue()+"\n";var rtnv=filesystem.write_str(par1.getJSValue(),str,true);if(!rtnv)throw new RuntimeError(this.first_line,"呼び出しが不正です");return new NullValue(loc)}else this.throwRuntimeError("putline","呼び出しが不正です")},null,function(argc){var str=argsPython(argc[1]);if(!(argc[1]instanceof StringValue))str="str("+str+")";return argsPython(argc[0])+".write("+str+" + '\n')"}),putstr:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof IntValue&&par2 instanceof StringValue){var str=par2.getJSValue();var rtnv=filesystem.write_str(par1.getJSValue(),str,false);if(!rtnv)this.throwRuntimeError("putstr","呼び出しが不正です");return new NullValue(loc)}else this.throwRuntimeError("putstr","呼び出しが不正です")},null,function(argc){var str=argsPython(argc[1]);if(!(argc[1]instanceof StringValue))str="str("+str+")";return argsPython(argc[0])+".write("+str+")"}),close:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue){var rtnv=filesystem.close(par1.getJSValue(),true);if(!rtnv)this.throwRuntimeError("close","呼び出しが不正です");return new NullValue(loc)}else this.throwRuntimeError("close","呼び出しが不正です")},null,function(argc){return argsPython(argc[0])+".close()\n"}),pop:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof ArrayValue){if(par1._value.length>0)return par1._value.pop();else this.throwRuntimeError("pop","空の配列にpopを適用しようとしました")}else this.throwRuntimeError("pop","popは配列にしか使えません")},null,function(argc){return argc[0]+".pop()"}),shift:new DefinedFunction(1,function(param,loc){var par1=param[0].getValue();if(par1 instanceof ArrayValue){if(par1._value.length>0)return par1._value.shift();else this.throwRuntimeError("shift","空の配列にshiftを適用しようとしました")}else this.throwRuntimeError("shift","shiftは配列にしか使えません")},null,function(argc){return argc[0]+".pop(0)"}),push:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof ArrayValue&&par2 instanceof Value){par1._value.push(par2);return new NullValue(loc)}else this.throwRuntimeError("push","pushは配列にしか使えません")},null,function(argc){return argsPython(argc[0])+".append("+argsPython(argc[1])+")\n"}),unshift:new DefinedFunction(2,function(param,loc){var par1=param[0].getValue();var par2=param[1].getValue();if(par1 instanceof ArrayValue&&par2 instanceof Value){par1._value.unshift(par2);return new NullValue(loc)}else this.throwRuntimeError("unshift","unshiftは配列にしか使えません")},null,function(argc){return argsPython(argc[0])+".insert(0, "+argsPython(argc[1])+")\n"})};"use strict";var storage=localStorage;class FileIO{constructor(){this.clear()}clear(){this.files=[]}all_close(){for(var i=0;i<this.files.length;i++){try{if(this.files[n].mode=="r")this.close(i)}catch(e){return false}this.files[n]=null}return true}openr(filename){var value=storage.getItem(filename);if(value){this.files.push({name:filename,val:value,pos:0,mode:"r"});return this.files.length-1}return-1}openw(filename){this.files.push({name:filename,val:"",pos:0,mode:"w"});return this.files.length-1}opena(filename){var value=storage.getItem(filename);var str=value?value:"";this.files.push({name:filename,val:str,pos:str.length,mode:"w"});return this.files.length-1}close(n){if(n>=0&&n<this.files.length){if(this.files[n]){if(this.files[n].mode=="w"){try{storage.setItem(this.files[n].name,this.files[n].val)}catch(e){this.files[n]=null;return false}}}this.files[n]=null;return true}else return false}read_line(n){if(n<0||n>=this.files.length||this.files[n]==null)return null;if(this.files[n].pos>=this.files[n].val.length)return"";var re=/([^\r\n]*)(\r\n|\r|\n)/;var substr=this.files[n].val.substring(this.files[n].pos);var res=re.exec(substr);if(res){this.files[n].pos+=res[1].length+res[2].length;return res[0]}else{this.files[n].pos+=substr.length;return substr}}read_ch(n){if(n<0||n>=this.files.length||this.files[n]==null)return null;if(this.files[n].pos>=this.files[n].val.length)return"";return this.files[n].val[this.files[n].pos++]}write_str(n,str,newline){if(n<0||n>=this.files.length||this.files[n]==null)return false;if(this.files[n].mode=="w"){this.files[n].val+=str+(newline?"\n":"");return true}else return false}}document.getElementById("storage_download").onclick=function(ev){var element=document.getElementById("storage_download");var list=document.getElementById("storage_list");var n=list.options.selectedIndex;if(n>=0&&n<storage.length){var filename=list.options[n].value;var str=storage.getItem(filename);var blob=new Blob([str],{type:"text/plain"});if(window.navigator.msSaveBlob){window.navigator.msSaveBlob(blob,filename)}else{window.URL=window.URL||window.webkitURL;element.setAttribute("href",window.URL.createObjectURL(blob));element.setAttribute("download",filename)}}else{element.removeAttribute("href")}};document.getElementById("storage_upload1").onclick=function(ev){document.getElementById("storage_upload").click();return false};document.getElementById("storage_upload").addEventListener("change",function(ev){var file=ev.target.files;var reader=new FileReader;reader.readAsText(file[0],"UTF-8");reader.onload=function(ev){var data=reader.result;try{storage.setItem(file[0].name,data);storage_list_update()}catch(e){window.alert("ストレージに保存できませんでした")}}});document.getElementById("storage_remove").onclick=function(ev){var list=document.getElementById("storage_list");var n=list.options.selectedIndex;if(n>=0){var key=list.options[n].value;storage.removeItem(key);storage_list_update()}};document.getElementById("storage_clear").onclick=function(ev){if(window.confirm("ストレージを空にしていいですか？")){storage.clear();storage_list_update()}};function storage_list_update(){var list=document.getElementById("storage_list");while(list.options.length)list.options.remove(0);var n=storage.length;if(n>0){for(var i=0;i<n;i++){var option=document.createElement("option");option.text=option.value=storage.key(i);list.appendChild(option)}}else{var option=document.createElement("option");option.text="--空--";list.appendChild(option)}}var filesystem=new FileIO;var graphColor=["#c00000","#00c000","#0000c0","#007070","#700070","#707000"];class GraphicStatement extends Statement{constructor(command,args,loc){super(loc);this.command=command;this.args=args;this.state=0}clone(){var args=[];for(var i=0;i<this.args.length;i++)args.push(this.args[i].clone());return new GraphicStatement(this.command,args,this.loc)}run(){if(this.state==0){if(this.args)code[0].stack.unshift({statementlist:this.args,index:0});this.state=1}else{code[0].stack[0].index++;if(this.command=="gOpenWindow"){var canvas=document.getElementById("canvas");context=canvas.getContext("2d");canvas.setAttribute("width",Number(this.args[0].getJSValue())+"px");canvas.setAttribute("height",Number(this.args[1].getJSValue())+"px");canvas.style.display="block"}else if(this.command=="gCloseWindow"){var canvas=document.getElementById("canvas");canvas.style.display="none";context=null}else if(this.command=="gClearWindow"){var canvas=document.getElementById("canvas");context.clearRect(0,0,canvas.width,canvas.height)}else if(this.command=="gSetLineColor"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let r=Number(this.args[0].getJSValue()),g=Number(this.args[1].getJSValue()),b=Number(this.args[2].getJSValue());context.strokeStyle="rgb("+r+","+g+","+b+")"}else if(this.command=="gSetFillColor"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let r=Number(this.args[0].getJSValue()),g=Number(this.args[1].getJSValue()),b=Number(this.args[2].getJSValue());context.fillStyle="rgb("+r+","+g+","+b+")"}else if(this.command=="gSetTextColor"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let r=Number(this.args[0].getJSValue()),g=Number(this.args[1].getJSValue()),b=Number(this.args[2].getJSValue());context.textStyle="rgb("+r+","+g+","+b+")"}else if(this.command=="gSetLineWidth"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");context.lineWidth=Number(this.args[0].getJSValue())}else if(this.command=="gSetFontSize"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");context.font=Number(this.args[0].getJSValue())+"px 'sans-serif'"}else if(this.command=="gDrawText"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");var temp=context.fillStyle;context.fillStyle=context.textStyle;context.fillText(this.args[0].getJSValue(),Number(this.args[1].getJSValue()),Number(this.args[2].getJSValue()));context.fillStyle=temp}else if(this.command=="gDrawLine"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),x2=Number(this.args[2].getJSValue()),y2=Number(this.args[3].getJSValue());context.beginPath();context.moveTo(x1,y1);context.lineTo(x2,y2);context.stroke()}else if(this.command=="gDrawPoint"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=numthis.args[0].getJSValue(),y1=this.args[1].getJSValue();context.beginPath();context.arc(x1,y1,1,0,Math.PI*2,false);context.stroke()}else if(this.command=="gDrawBox"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),width=Number(this.args[2].getJSValue()),height=Number(this.args[3].getJSValue());context.beginPath();context.strokeRect(x1,y1,width,height);context.stroke()}else if(this.command=="gFillBox"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),width=Number(this.args[2].getJSValue()),height=Number(this.args[3].getJSValue());context.fillRect(x1,y1,width,height);context.beginPath();context.strokeRect(x1,y1,width,height);context.stroke()}else if(this.command=="gDrawCircle"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),r=Number(this.args[2].getJSValue());context.beginPath();context.arc(x1,y1,r,0,Math.PI*2,false);context.stroke()}else if(this.command=="gFillCircle"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),r=Number(this.args[2].getJSValue());for(var i=0;i<2;i++){context.beginPath();context.arc(x1,y1,r,0,Math.PI*2,false);if(i==0)context.fill();else context.stroke()}}else if(this.command=="gDrawOval"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),w=Number(this.args[2].getJSValue()),h=Number(this.args[3].getJSValue());context.beginPath();context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,0,Math.PI*2);context.stroke()}else if(this.command=="gFillOval"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),w=Number(this.args[2].getJSValue()),h=Number(this.args[3].getJSValue());for(var i=0;i<2;i++){context.beginPath();context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,0,Math.PI*2);if(i==0)context.fill();else context.stroke()}}else if(this.command=="gDrawArc"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),w=Number(this.args[2].getJSValue()),h=Number(this.args[3].getJSValue()),theta1=Number(this.args[4].getJSValue()),theta2=Number(this.args[5].getJSValue()),style=Number(this.args[6].getJSValue());context.beginPath();context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,-theta1*Math.PI/180,-theta2*Math.PI/180,true);switch(style){case 2:context.lineTo(x1+w/2,y1+h/2);case 1:context.closePath()}context.stroke()}else if(this.command=="gFillArc"){if(context==null)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=Number(this.args[0].getJSValue()),y1=Number(this.args[1].getJSValue()),w=Number(this.args[2].getJSValue()),h=Number(this.args[3].getJSValue()),theta1=Number(this.args[4].getJSValue()),theta2=Number(this.args[5].getJSValue()),style=Number(this.args[6].getJSValue());for(var i=0;i<2;i++){context.beginPath();context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,-theta1*Math.PI/180,-theta2*Math.PI/180,true);switch(style){case 2:context.lineTo(x1+w/2,y1+h/2);case 1:context.closePath()}if(i==0)context.fill();else context.stroke()}}else if(this.command=="gBarplot"){if(context==null){var canvas=document.getElementById("canvas");var w=Number(this.args[0].getJSValue()),h=Number(this.args[1].getJSValue());context=canvas.getContext("2d");canvas.setAttribute("width",w+"px");canvas.setAttribute("height",h+"px");canvas.style.display="block"}var values=array2values(this.args[2],this.loc);var max=0,min=0,maxn=0;for(var i=0;i<values.length;i++){var l=values[i].length;if(l>maxn)maxn=l;for(var j=0;j<l;j++){var v1=values[i][j];if(v1>max)max=v1;if(v1<min)min=v1}}if(max==0)max=1;var x0=w*.05,y0=h*.95;y0*=max/(max-min);w*=.9;h*=.9;context.beginPath();context.moveTo(x0,y0-h*max/(max-min));context.lineTo(x0,y0-h*min/(max-min));context.moveTo(x0,y0);context.lineTo(x0+w,y0);context.stroke();if(values.length>0){var w0=w/maxn/values.length;for(var i=0;i<values.length;i++){context.fillStyle=graphColor[i%6];context.beginPath();for(var j=0;j<values[i].length;j++){var x=x0+w0*j+w0/2,y=y0-values[i][j]/(max-min)*h;if(values[i][j]>=0)context.fillRect(x0+w0*j*values.length+w0*.8*i+w0*.1,y0-h*(values[i][j]/(max-min)),w0*.8,h*(values[i][j]/(max-min)));else context.fillRect(x0+w0*j*values.length+w0*.8*i+w0*.1,y0,w0*.8,h*(-values[i][j]/(max-min)))}context.stroke()}}}else if(this.command=="gLineplot"){if(context==null){var canvas=document.getElementById("canvas");var w=Number(this.args[0].getJSValue()),h=Number(this.args[1].getJSValue());context=canvas.getContext("2d");canvas.setAttribute("width",w+"px");canvas.setAttribute("height",h+"px");canvas.style.display="block"}var values=array2values(this.args[2],this.loc);var max=0,min=0,maxn=0;for(var i=0;i<values.length;i++){var l=values[i].length;if(l>maxn)maxn=l;for(var j=0;j<l;j++){var v1=values[i][j];if(v1>max)max=v1;if(v1<min)min=v1}}if(max==0)max=1;var x0=w*.05,y0=h*.95;y0*=max/(max-min);w*=.9;h*=.9;context.beginPath();context.moveTo(x0,y0-h*max/(max-min));context.lineTo(x0,y0-h*min/(max-min));context.moveTo(x0,y0);context.lineTo(x0+w,y0);context.stroke();if(values.length>0){var w0=w/maxn;for(var i=0;i<values.length;i++){context.strokeStyle=graphColor[i%6];context.beginPath();for(var j=0;j<values[i].length;j++){var x=x0+w0*j+w0/2,y=y0-values[i][j]/(max-min)*h;if(j==0)context.moveTo(x,y);else context.lineTo(x,y)}context.stroke()}}}else if(this.command=="gDrawGraph"){drawGraph(this.args[0].getValue(),this.args[1].getValue(),this.loc)}else if(this.command=="gClearGraph"){clearGraph()}else{throw new RuntimeError(this.first_line,"未実装のコマンド"+this.command+"が使われました")}this.state=0}}makePython(indent){throw new RuntimeError(this.first_line,"グラフィック命令はPythonに変換できません")}}function clearGraph(){Plotly.purge(document.getElementById("graph"))}function drawGraph(layout,data,loc){var div=document.getElementById("graph");var graph_data=[],graph_layout={};if(layout instanceof DictionaryValue){for(var key of layout.value.keys()){var val=layout.value.get(key).getValue();if(val instanceof ArrayValue){graph_layout[key]={};for(var key1 of val.value.keys())graph_layout[key][key1]=val2obj(val.value.get(key1).getValue())}else graph_layout[key]=val2obj(val)}}else if(layout)throw new RuntimeError(loc.first_line,"レイアウト情報が辞書になっていません");if(data instanceof ArrayValue){var dl=data.value.length;for(var i=0;i<dl;i++){var d=data.value[i].getValue();if(d instanceof DictionaryValue){var va={};for(var key of d.value.keys()){var val=d.value.get(key).getValue();va[key]=val2obj(val)}graph_data.push(va)}else throw new RuntimeError(loc.first_line,"データの"+i+"番目の要素が辞書になっていません")}}else throw new RuntimeError(loc.first_line,"データが配列になっていません");Plotly.newPlot(div,graph_data,graph_layout)}var dragging=false;var mouseX,mouseY;class point{constructor(){this._x=this._y=0}get x(){return this._x}set x(v){this._x=v}get y(){return this._y}set y(v){this._y=v}clone(){var p=new point;p.x=this.x;p.y=this.y;return p}}function mouseDown(e){var rect=document.getElementById("flowchart").getBoundingClientRect();var x=e.clientX-rect.left;var y=e.clientY-rect.top;var parts=flowchart.findParts(x,y);if(parts==null)return;dragging=true;mouseX=x;mouseY=y}function mouseUp(e){dragging=false}function mouseMove(e){if(dragging){var rect=document.getElementById("flowchart").getBoundingClientRect();var x=e.clientX-rect.left;var y=e.clientY-rect.top;flowchart.moveOrigin(x-mouseX,y-mouseY);mouseX=x;mouseY=y;flowchart.paint()}}function doubleclick_Flowchart(evt){if(!editable_flag){alert("プログラム実行・中断中はプログラムを編集できません");return}dragging=false;var rect=evt.target.getBoundingClientRect();var x=evt.clientX-rect.left;var y=evt.clientY-rect.top;var parts=flowchart.findParts(x,y);if(parts==null||parts instanceof Parts_Terminal||parts instanceof Parts_Bar||parts instanceof Parts_Null)return;parts.editMe()}function variableChange(e){flowchart.flowchart2code();makeDirty(true)}function contextMenu_Flowchart(trigger,event){dragging=false;var x=event.offsetX,y=event.offsetY;var parts=flowchart.findParts(x,y);if(parts==null||parts instanceof Parts_Terminal||parts instanceof Parts_Null)return false;if(parts instanceof Parts_Bar)return{selectableSubMenu:true,events:{show:function(){parts.highlight()},hide:function(){flowchart.paint();flowchart.flowchart2code()}},callback:function(k,e){callbackPartsBar(parts,k)},items:{input:{name:"入力",icon:"input"},output:{name:"出力",icon:"output"},substitute:{name:"代入",icon:"assign"},if:{name:"分岐",icon:"if"},loop:{name:"ループ",icon:"loop",items:{loop1:{name:"〜の間"},loopinc:{name:"増やしながら"},loopdec:{name:"減らしながら"},loopfor:{name:"配列の要素について"}}},array:{name:"配列操作",items:{append:{name:"追加"},extend:{name:"連結"}}},misc:{name:"各種命令"}}};return{callback:function(k,e){callbackParts(parts,k)},events:{show:function(){parts.highlight()},hide:function(){flowchart.paint();flowchart.flowchart2code()}},items:{edit:{name:"編集"},delete:{name:"削除"}}}}function callbackPartsBar(bar,key){if(document.getElementById("sourceTextarea").readOnly){window.alert("プログラム実行・中断中はプログラムを編集できません");return}bar.highlight();if(key=="input")Parts_Input.appendMe(bar);else if(key=="output")Parts_Output.appendMe(bar);else if(key=="substitute")Parts_Substitute.appendMe(bar);else if(key=="append")Parts_Append.appendMe(bar);else if(key=="extend")Parts_Extend.appendMe(bar);else if(key=="if")Parts_If.appendMe(bar);else if(key=="loop1")Parts_LoopBegin1.appendMe(bar);else if(key=="loopinc")Parts_LoopBeginInc.appendMe(bar);else if(key=="loopdec")Parts_LoopBeginDec.appendMe(bar);else if(key=="loopfor")Parts_LoopBeginFor.appendMe(bar);else if(key=="misc")Parts_Misc.appendMe(bar);else return;makeDirty(true)}function callbackParts(parts,key){if(document.getElementById("sourceTextarea").readOnly){window.alert("プログラム実行・中断中はプログラムを編集できません");return}if(parts instanceof Parts_Terminal)return false;if(key=="edit"){parts.editMe()}else if(key=="delete"){parts.deleteMe();makeDirty(true)}else if(key=="cut"){parts.cutMe();makeDirty(true)}}var FlowchartSetting={size:6,fontsize:12};function changeSize(v){if(v>0)FlowchartSetting.size++;else if(v<0){if(FlowchartSetting.size>3)FlowchartSetting.size--}else FlowchartSetting.size=6;flowchart.paint()}function variable2code(ty,id){var code=document.getElementById(id).value.trim();if(code!="")return ty+" "+code+"\n";return""}class Flowchart{constructor(){this._canvas=document.getElementById("flowchart");this._context=this._canvas.getContext("2d");this.makeEmpty()}get x0(){return this._x0}get y0(){return this._y0}get canvas(){return this._canvas}get context(){return this._context}setOrigin(x,y){this._x0=x;this._y0=y}moveOrigin(x,y){this._x0+=x;this._y0+=y}makeEmpty(){this.setOrigin(this.canvas.width/2,FlowchartSetting.size);this.top=new Parts_Terminal;var bar=new Parts_Bar;var end=new Parts_Terminal;this.top.next=bar;bar.next=end;this.top.setValue("はじめ");end.setValue("おわり")}code2flowchart(parse){flowchart.makeEmpty();Flowchart.appendParts(this.top.next,parse);flowchart.paint()}static appendParts(parts,statementlist){for(var i=0;i<statementlist.length;i++){var p=statementlist[i];if(!p)continue;var statement=constructor_name(p);if(statement=="Assign"){var p1=new Parts_Substitute;var b1=new Parts_Bar;var c=constructor_name(p.value);var brace=false;p1.setValue(argsPyPEN(p.variable),(brace?"(":"")+argsPyPEN(p)+(brace?")":""),p.operator);parts.next=p1;parts=p1.next=b1}else if(statement=="Append"){var p1=new Parts_Append;var b1=new Parts_Bar;p1.setValue(argsPyPEN(p.variable),argsPyPEN(p.value));parts.next=p1;parts=p1.next=b1}else if(statement=="Extend"){var p1=new Parts_Extend;var b1=new Parts_Bar;p1.setValue(argsPyPEN(p.variable),argsPyPEN(p.value));parts.next=p1;parts=p1.next=b1}else if(statement=="Input"){var p1=new Parts_Input;var b1=new Parts_Bar;p1.setValue(argsPyPEN(p.variable),p.type);parts.next=p1;parts=p1.next=b1}else if(statement=="Output"){var p1=new Parts_Output;var b1=new Parts_Bar;var v0=[];for(var j=0;j<p.value.length;j++)v0.push(argsPyPEN(p.value[j]));p1.setValue(v0.join(","),p.ln);parts.next=p1;parts=p1.next=b1}else if(statement=="Newline"){var p1=new Parts_Output;var b1=new Parts_Bar;p1.setValue("改行",true);parts.next=p1;parts=p1.next=b1}else if(statement=="If"){var p1=new Parts_If;var b1=new Parts_Bar,b2=new Parts_Bar,b3=new Parts_Bar;var n1=new Parts_Null,n2=new Parts_Null,n3=new Parts_Null;p1.setValue(argsPyPEN(p.blocks[0][0]));parts.next=p1;p1.next=n1;n1.next=b1;p1.left=b2;b2._prev=p1;b2.next=n2;p1.right=b3;b3._prev=p1;b3.next=n3;if(p.blocks[0][1])Flowchart.appendParts(b2,p.blocks[0][1]);if(p.blocks.length>1){if(p.blocks.length==2&&!p.blocks[1][0]){if(p.blocks[1][1])Flowchart.appendParts(b3,p.blocks[1][1])}else throw new RuntimeError(-1,"「そうでなくもし」はフローチャートで表せません。")}parts=b1}else if(statement=="ForInc"){var p1=new Parts_LoopBeginInc,p2=new Parts_LoopEnd;var b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(argsPyPEN(p.variable),argsPyPEN(p.begin),argsPyPEN(p.end),argsPyPEN(p.step));parts.next=p1;p1.next=b1;b1.next=p2;p2.next=b2;p1._end=p2;p2._begin=p1;Flowchart.appendParts(b1,p.statementlist);parts=b2}else if(statement=="ForDec"){var p1=new Parts_LoopBeginDec,p2=new Parts_LoopEnd;var b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(argsPyPEN(p.variable),argsPyPEN(p.begin),argsPyPEN(p.end),argsPyPEN(p.step));parts.next=p1;p1.next=b1;b1.next=p2;p2.next=b2;p1._end=p2;p2._begin=p1;Flowchart.appendParts(b1,p.statementlist);parts=b2}else if(statement=="ForIn"){var p1=new Parts_LoopBeginFor,p2=new Parts_LoopEnd;var b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(argsPyPEN(p.array),argsPyPEN(p.variable));parts.next=p1;p1.next=b1;b1.next=p2;p2.next=b2;p1._end=p2;p2._begin=p1;Flowchart.appendParts(b1,p.statementlist);parts=b2}else if(statement=="While"){var p1=new Parts_LoopBegin1,p2=new Parts_LoopEnd;var b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(argsPyPEN(p.condition));parts.next=p1;p1.next=b1;b1.next=p2;p2.next=b2;p1._end=p2;p2._begin=p1;Flowchart.appendParts(b1,p.statementlist);parts=b2}else if(statement=="FileIOStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue(p.command,p.args);parts.next=p1;parts=p1.next=b1}else if(statement=="GraphicStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue(p.command,p.args);parts.next=p1;parts=p1.next=b1}else if(statement=="SleepStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue("sleep",[p.sec]);parts.next=p1;parts=p1.next=b1}else if(statement=="BreakStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue("break",[]);parts.next=p1;parts=p1.next=b1}else if(statement=="DumpStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue("dump",[]);parts.next=p1;parts=p1.next=b1}else if(statement=="NopStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue("NopStatement",[]);parts.next=p1;parts=p1.next=b1}else if(statement=="PauseStatement"){var p1=new Parts_Misc;var b1=new Parts_Bar;p1.setValue("PauseStatement",[]);parts.next=p1;parts=p1.next=b1}}}flowchart2code(){if(!flowchart_display)return;var newcode=this.top.appendCode("",0);editor.getDoc().setValue(newcode);editor.focus()}paint(){if(!flowchart_display)return;var canvas_width=this.canvas.width;var canvas_height=this.canvas.height;var p0=new point,p1=new point,p2=new point;this.context.clearRect(0,0,canvas_width,canvas_height);FlowchartSetting.fontsize=FlowchartSetting.size*2;this.context.font=FlowchartSetting.fontsize+"px 'sans-serif'";this.context.strokeStyle="rgb(0,0,0)";this.context.fillStyle="rgb(0,0,0)";this.context.lineWidth="1px";this.top.calcSize(p0,p1,p2);this.top.paint({x:this.x0,y:this.y0})}findParts(x,y){return this.top.findParts(x,y)}}class Parts{constructor(){this._text="";this._next=this._prev=null;this._textwidth=this._textheight=this._width=this._height=0;this._hspace=this._hspace2=0}get x1(){return this._x1}set x1(x){this._x1=x}get y1(){return this._y1}set y1(y){this._y1=y}get x2(){return this._x2}set x2(x){this._x2=x}get y2(){return this._y2}set y2(y){this._y2=y}get text(){return this._text}get next(){return this._next}set next(p){p._next=this.next;p._prev=this;if(this.next!=null)this.next._prev=p;this._next=p}get prev(){return this._prev}get end(){return this}get width(){return this._width}get height(){return this._height}get textWidth(){return this._textwidth}get textHeight(){return this._textheight}get hspace(){return this._hspace}get hspace2(){return this._hspace2}get isBlockEnd(){return false}inside(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2}findParts(x,y){var p=this;while(p!=null&&!(p instanceof Parts_Null)){if(p.inside(x,y))return p;if(p instanceof Parts_If){var p1=p.left.findParts(x,y);if(p1)return p1;p1=p.right.findParts(x,y);if(p1)return p1;p=p.end.next}else p=p.next}if(p!=null&&p.next!=null)return p.next.findParts(x,y);return null}paint(position){if(this.next!=null)return this.next.paint(position);return this}calcTextsize(){if(this.text!=null&&this.text!=""){var size=FlowchartSetting.size;var metrics=flowchart.context.measureText(this.text);this._hspace=0;this._textwidth=metrics.width;if(this._textwidth<size*4){this._hspace=(size*4-this._textwidth)/2;this._textwidth=size*4}this._textheight=FlowchartSetting.fontsize}}calcSize(p0,p1,p2){if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}static appendMe(bar){}appendCode(code,indent){if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){}deleteMe(){this.prev._next=this.end.next.next;this.end.next.next._prev=this.prev;this.end._next=null;this._next=null}cutMe(){}paint_highlight(){flowchart.context.strokeStyle="rgb(255,0,0)";flowchart.context.fillStyle="rgb(255,0,0)";flowchart.context.clearRect(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1);this.paint(null);flowchart.context.strokeStyle="rgb(0,0,0)";flowchart.context.fillStyle="rgb(0,0,0)"}paint_unhighlight(){flowchart.context.clearRect(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1);this.paint(null)}highlight(){this.paint_highlight()}unhighlight(){this.paint_unhighlight()}}class Parts_Null extends Parts{get isBlockEnd(){return true}}class Parts_Bar extends Parts{calcSize(p0,p1,p2){this._width=0;this._height=FlowchartSetting.size*3;p0.y+=this._height;if(p0.y>p2.y)p2.y=p0.y;return this.next.calcSize(p0,p1,p2)}inside(x,y){var near=4;return this.x1-near<=x&&x<=this.x2+near&&this.y1<=y&&y<=this.y2}paint(position){if(position!=null){this.x1=this.x2=position.x;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.stroke();if(position!=null){position.x=this.x2;position.y=this.y2;return this.next.paint(position)}return this}}class Parts_Terminal extends Parts{calcSize(p0,p1,p2){this.calcTextsize();this._height=this._textheight+FlowchartSetting.size*2;this._width=this._textwidth+this._height;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null)return this;return this.next.calcSize(p0,p1,p2)}setValue(v){this._text=v}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.textWidth/2-this.height/2;this.x2=position.x+this.textWidth/2+this.height/2;this.y1=position.y;this.y2=position.y+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1+this.height/2,this.y1);flowchart.context.lineTo(this.x2-this.height/2,this.y1);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.arc(this.x2-this.height/2,this.y1+this.height/2,this.height/2,Math.PI/2,-Math.PI/2,true);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.moveTo(this.x1+this.height/2,this.y2);flowchart.context.lineTo(this.x2-this.height/2,this.y2);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.arc(this.x1+this.height/2,this.y1+this.height/2,this.height/2,3*Math.PI/2,Math.PI/2,true);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+this.height/2,this.y2-FlowchartSetting.size);if(position!=null){position.y+=this.height;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}}class Parts_Output extends Parts{constructor(){super();this.setValue("《値》",true)}get newline(){return this._newline}setValue(v,nl){this._text=v;this._newline=nl}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*2+this._height/2;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x2-this.height/2,this.y1);flowchart.context.lineTo(this.x1+size*2,this.y1);flowchart.context.lineTo(this.x1,(this.y1+this.y2)/2);flowchart.context.lineTo(this.x1+size*2,this.y2);flowchart.context.lineTo(this.x2-this.height/2,this.y2);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.arc(this.x2-this.height/2,(this.y1+this.y2)/2,this.height/2,Math.PI/2,-Math.PI/2,true);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2+this.hspace,this.y2-size);if(!this.newline&&this.text!="改行"){var x=this.x2-this.height/2;var y=this.y1+size;flowchart.context.beginPath();flowchart.context.moveTo(x+size,y);flowchart.context.lineTo(x+size,y+this.textHeight);flowchart.context.lineTo(x,y+this.textHeight);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.moveTo(x+size/2,y+this.textHeight-size/4);flowchart.context.lineTo(x,y+this.textHeight);flowchart.context.lineTo(x+size/2,y+this.textHeight+size/4);flowchart.context.stroke();x+=this.height/4;y+=this.textHeight/2;flowchart.context.beginPath();flowchart.context.moveTo(x-size/2,y-size/2);flowchart.context.lineTo(x+size/2,y+size/2);flowchart.context.stroke();flowchart.context.beginPath();flowchart.context.moveTo(x+size/2,y-size/2);flowchart.context.lineTo(x-size/2,y+size/2);flowchart.context.stroke()}if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Output;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);if(this.text=="改行")code+="改行する\n";else code+=(this.newline?"":"改行なしで")+"表示する("+this.text+")\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){var subtitle=["値","改行"];var values=[this.text,this.newline];openModalWindowforOutput("出力の編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1])}flowchart.paint();flowchart.flowchart2code()}}class Parts_Input extends Parts{constructor(){super();this.setValue("《変数》",0)}setValue(v,type){this._var=v;this.type=type;this._text=v+"を入力";if(this.type>0)this._text+="（"+nameOfType[this.type]+"）"}get var(){return this._var}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*4;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1+size);flowchart.context.lineTo(this.x2,this.y1-size);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1+size);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2,this.y2-size);if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Input;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);code+=this.var;if(this.type>0)code+="に"+nameOfType[this.type];code+="を入力する\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","型"];var values=[this.var,this.type];openModalWindowforInput("入力の編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1])}flowchart.paint();flowchart.flowchart2code()}}class Parts_Substitute extends Parts{constructor(){super();this.setValue("《変数》","《値》",null)}setValue(variable,value,operator){this._var=variable;this._val=value;this._operator=operator;this._text=this._var+(this._operator?this._operator:"")+"="+this._val}get var(){return this._var}get val(){return this._val}get operator(){return this._operator}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*4;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y1);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2,this.y2-size);if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Substitute;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);code+=this.var+(this.operator?this.operator:"")+"="+this.val+"\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","値","演算"];var values=[this.var,this.val,this.operator];openModalWindowforSubstitute("代入の編集",subtitle,values,this)}edited(values){if(values!=null){if(values[2]=="（なし）")values[2]=null;this.setValue(values[0],values[1],values[2])}flowchart.paint();flowchart.flowchart2code()}}class Parts_Append extends Parts{constructor(){super();this.setValue("《変数》","《値》")}setValue(variable,value){this._var=variable;this._val=value;this._text=this._var+"に"+this._val+"を追加"}get var(){return this._var}get val(){return this._val}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*4;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y1);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2,this.y2-size);if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Append;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);code+=this.var+"に"+this.val+"を追加する\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","値"];var values=[this.var,this.val];openModalWindow("追加の編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1])}flowchart.paint();flowchart.flowchart2code()}}class Parts_Extend extends Parts{constructor(){super();this.setValue("《変数》","《値》")}setValue(variable,value){this._var=variable;this._val=value;this._text=this._var+"に"+this._val+"を連結"}get var(){return this._var}get val(){return this._val}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*4;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y1);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2,this.y2-size);if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Append;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);code+=this.var+"に"+this.val+"を連結する\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","値"];var values=[this.var,this.val];openModalWindow("追加の編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1])}flowchart.paint();flowchart.flowchart2code()}}class Parts_If extends Parts{constructor(){super();this.setValue("《条件》");this.left=this.right=null;this.left_bar_expand=this.right_bar_expand=0}setValue(cond){this._cond=cond;this._text=this._cond}get condition(){return this._cond}get end(){return this.next}calcTextsize(){if(this.text!=null&&this.text!=""){var size=FlowchartSetting.size;var metrics=flowchart.context.measureText(this.text);this._hspace=0;this._textwidth=metrics.width;if(this._textwidth<size*6){this._hspace=(size*6-this._textwidth)/2;this._textwidth=size*6}this._textheight=FlowchartSetting.fontsize}}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this.v_margin=size*2;this.h_margin=this.textWidth*this.textHeight/this.v_margin/4;this._height=this.textHeight+this.v_margin*2;this._width=this.textWidth+this.h_margin*2;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var pl=new point;pl.x=x1;pl.y=p0.y;var pl1=pl.clone(),pl2=pl.clone();this.left.calcSize(pl,pl1,pl2);this.left_bar_expand=pl2.x-pl.x;if(this.left_bar_expand<size)this.left_bar_expand=size;pl1.x-=this.left_bar_expand;pl2.x-=this.left_bar_expand;if(pl1.x<p1.x)p1.x=pl1.x;if(pl1.y>p1.y)p1.y=pl1.y;if(pl2.y>p1.y)p1.y=pl2.y;var pr=new point;pr.x=x2;pr.y=p0.y;var pr1=pr.clone(),pr2=pr.clone();this.right.calcSize(pr,pr1,pr2);this.right_bar_expand=pr.x-pr1.x;if(this.right_bar_expand<size)this.right_bar_expand=size;pr1.x+=this.right_bar_expand;pr2.x+=this.right_bar_expand;if(pr2.x>p2.x)p2.x=pr2.x;if(pr1.y>p2.y)p2.y=pr1.y;if(pr2.y>p2.y)p2.y=pr2.y;if(pr1.x<pl2.x+size){this.right_bar_expand+=pl2.x-pr1.x+size;p2.x+=pl2.x-pr1.x+size}return this.end.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}var x0=(this.x1+this.x2)/2,y0=(this.y1+this.y2)/2;flowchart.context.beginPath();flowchart.context.moveTo(x0,this.y1);flowchart.context.lineTo(this.x1,y0);flowchart.context.lineTo(x0,this.y2);flowchart.context.lineTo(this.x2,y0);flowchart.context.lineTo(x0,this.y1);flowchart.context.stroke();flowchart.context.fillText(this.text,x0-this.textWidth/2+this.hspace,y0+this.textHeight/2);if(position!=null){flowchart.context.beginPath();flowchart.context.moveTo(this.x1,y0);flowchart.context.lineTo(this.x1-this.left_bar_expand,y0);flowchart.context.stroke();flowchart.context.fillText("Y",this.x1-size*1,y0-size);var left_parts=this.left.paint({x:this.x1-this.left_bar_expand,y:y0}).prev;flowchart.context.beginPath();flowchart.context.moveTo(this.x2,y0);flowchart.context.lineTo(this.x2+this.right_bar_expand,y0);flowchart.context.stroke();flowchart.context.fillText("N",this.x2+size*0,y0-size);var right_parts=this.right.paint({x:this.x2+this.right_bar_expand,y:y0}).prev;var y;if(left_parts.y2>right_parts.y2){y=left_parts.y2;flowchart.context.beginPath();flowchart.context.moveTo(this.x2+this.right_bar_expand,right_parts.y2);flowchart.context.lineTo(this.x2+this.right_bar_expand,y);flowchart.context.stroke();right_parts.y2=y}else{y=right_parts.y2;flowchart.context.beginPath();flowchart.context.moveTo(this.x1-this.left_bar_expand,left_parts.y2);flowchart.context.lineTo(this.x1-this.left_bar_expand,y);flowchart.context.stroke();left_parts.y2=y}flowchart.context.beginPath();flowchart.context.moveTo(this.x1-this.left_bar_expand,y);flowchart.context.lineTo(this.x2+this.right_bar_expand,y);flowchart.context.stroke();position.y=y;if(this.end.next!=null)return this.end.next.paint(position)}return this.end.next}static appendMe(bar){var parts=new Parts_If;bar.next=parts;parts.next=new Parts_Null;parts.next.next=new Parts_Bar;parts.left=new Parts_Bar;parts.left._prev=parts;parts.left.next=new Parts_Null;parts.right=new Parts_Bar;parts.right._prev=parts;parts.right.next=new Parts_Null;return parts.end.next.next}appendCode(code,indent){code+=makeIndent(indent);code+="もし"+this.condition+"ならば：\n";if(this.left.next instanceof Parts_Null)code+=makeIndent(indent+1)+"\n";else code+=this.left.appendCode("",indent+1);if(!(this.right.next instanceof Parts_Null)){code+=makeIndent(indent)+"そうでなければ：\n";code+=this.right.appendCode("",indent+1)}if(this.end.next!=null)return this.end.next.appendCode(code,indent);return code}editMe(){var subtitle=["条件"];var values=[this.condition];openModalWindow("分岐の編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0])}flowchart.paint();flowchart.flowchart2code()}}class Parts_LoopBegin extends Parts{get hasText(){return false}get end(){return this._end}calcTextsize(){if(this.hasText){var size=FlowchartSetting.size;this._textwidth=size*6;this._hspace=this._hspace2=0;var tw=flowchart.context.measureText(this.text).width;if(tw>this._textwidth)this._textwidth=tw;if(tw<this._textwidth)this._hspace=(this._textwidth-tw)/2;if(this.text2){var tw2=flowchart.context.measureText(this.text2).width;if(tw2>this._textwidth)this._textwidth=tw2;if(tw<this._textwidth)this._hspace=(this._textwidth-tw)/2;if(tw2<this._textwidth)this._hspace2=(this._textwidth-tw2)/2}this._textheight=FlowchartSetting.fontsize}else{this.end.calcTextsize();this._textwidth=this.end.textWidth;this._textheight=this.end.textHeight}}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this.textHeight*(this.hasText&&this.text2?2:1)+size*2;this._width=this.textWidth+size*2;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;var n=this.next;while(n!=this.end)n=n.calcSize(p0,p1,p2);return this.end.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1+size,this.y1);flowchart.context.lineTo(this.x2-size,this.y1);flowchart.context.lineTo(this.x2,this.y1+size);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1+size);flowchart.context.lineTo(this.x1+size,this.y1);flowchart.context.stroke();if(this.hasText){flowchart.context.fillText(this.text,this.x1+size+this.hspace,this.y1+size+this.textHeight);if(this.text2)flowchart.context.fillText(this.text2,this.x1+size+this.hspace2,this.y1+size+this.textHeight*2)}if(position!=null){position.y=this.y2;this.next.paint(position);return this.end.next.paint(position)}return this}deleteMe(){this.prev._next=this.end.next.next;this.end.next.next._prev=this.prev;this.end._next=null;this._next=null}highlight(){this.paint_highlight();this.end.paint_highlight()}unhighlight(){this.paint_unhighlight();this.end.paint_unhighlight()}}class Parts_LoopBegin1 extends Parts_LoopBegin{get hasText(){return true}constructor(){super();this.setValue("《条件》")}setValue(cond){this._cond=cond;this._text=this._cond}get condition(){return this._cond}get text2(){return"の間"}static appendMe(bar){var parts=new Parts_LoopBegin1;bar.next=parts;parts.next=new Parts_Bar;parts.next.next=new Parts_LoopEnd;parts.next.next.next=new Parts_Bar;parts._end=parts.next.next;parts.next.next._begin=parts;return parts.end}appendCode(code,indent){code+=makeIndent(indent);code+=this.condition+"の間：\n";var code_inner=this.next.appendCode("",indent+1);if(code_inner=="")code+=makeIndent(indent+1)+"\n";else code+=code_inner;if(this.end.next!=null)return this.end.next.appendCode(code,indent);return code}editMe(){var subtitle=["条件（〜の間）"];var values=[this.condition];openModalWindow("繰り返しの編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0])}flowchart.paint();flowchart.flowchart2code()}}class Parts_LoopBeginFor extends Parts_LoopBegin{get hasText(){return true}constructor(){super();this.setValue("《配列》","《変数》")}setValue(array,variable){this.array=array;this.variable=variable;this._text=this.variable+":"+this.array}get text2(){return null}static appendMe(bar){var parts=new Parts_LoopBeginFor;bar.next=parts;parts.next=new Parts_Bar;parts.next.next=new Parts_LoopEnd;parts.next.next.next=new Parts_Bar;parts._end=parts.next.next;parts.next.next._begin=parts;return parts.end}appendCode(code,indent){code+=makeIndent(indent);code+=this.array+"の要素"+this.variable+"について繰り返す：\n";var code_inner=this.next.appendCode("",indent+1);if(code_inner=="")code+=makeIndent(indent+1)+"\n";else code+=code_inner;if(this.end.next!=null)return this.end.next.appendCode(code,indent);return code}editMe(){var subtitle=["配列","変数"];var values=[this.array,this.variable];openModalWindow("繰り返しの編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1])}flowchart.paint();flowchart.flowchart2code()}}class Parts_LoopBeginInc extends Parts_LoopBegin{get hasText(){return true}constructor(){super();this.setValue("《変数》","《値》","《値》","《値》")}setValue(variable,start,goal,step){this._var=variable;this._start=start;this._goal=goal;this._step=step;this._text=this.var+":"+this.start+"→"+this.goal}get var(){return this._var}get start(){return this._start}get goal(){return this._goal}get step(){return this._step}get text2(){return this.step+"ずつ増"}static appendMe(bar){var parts=new Parts_LoopBeginInc;bar.next=parts;parts.next=new Parts_Bar;parts.next.next=new Parts_LoopEnd;parts.next.next.next=new Parts_Bar;parts._end=parts.next.next;parts.next.next._begin=parts;return parts.end}appendCode(code,indent){code+=makeIndent(indent);code+=this.var+"を"+this.start+"から"+this.goal+"まで"+this.step+"ずつ増やしながら：\n";var code_inner=this.next.appendCode("",indent+1);if(code_inner=="")code+=makeIndent(indent+1)+"\n";else code+=code_inner;if(this.end.next!=null)return this.end.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","〜から","〜まで","増加分"];var values=[this.var,this.start,this.goal,this.step];openModalWindow("繰り返しの編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1],values[2],values[3])}flowchart.paint();flowchart.flowchart2code()}}class Parts_LoopBeginDec extends Parts_LoopBegin{get hasText(){return true}constructor(){super();this.setValue("《変数》","《値》","《値》","《値》")}setValue(variable,start,goal,step){this._var=variable;this._start=start;this._goal=goal;this._step=step;this._text=this.var+":"+this.start+"→"+this.goal}get var(){return this._var}get start(){return this._start}get goal(){return this._goal}get step(){return this._step}get text2(){return this.step+"ずつ減"}static appendMe(bar){var parts=new Parts_LoopBeginDec;bar.next=parts;parts.next=new Parts_Bar;parts.next.next=new Parts_LoopEnd;parts.next.next.next=new Parts_Bar;parts._end=parts.next.next;parts.next.next._begin=parts;return parts.end}appendCode(code,indent){code+=makeIndent(indent);code+=this.var+"を"+this.start+"から"+this.goal+"まで"+this.step+"ずつ減らしながら：\n";var code_inner=this.next.appendCode("",indent+1);if(code_inner=="")code+=makeIndent(indent+1)+"\n";else code+=code_inner;if(this.end.next!=null)return this.end.next.appendCode(code,indent);return code}editMe(){var subtitle=["変数","〜から","〜まで","減少分"];var values=[this.var,this.start,this.goal,this.step];openModalWindow("繰り返しの編集",subtitle,values,this)}edited(values){if(values!=null){this.setValue(values[0],values[1],values[2],values[3])}flowchart.paint();flowchart.flowchart2code()}}class Parts_LoopEnd extends Parts{get hasText(){return false}get begin(){return this._begin}get isBlockEnd(){return true}editMe(){this.begin.editMe()}calcTextsize(){if(this.hasText){var size=FlowchartSetting.size;this._textwidth=size*6;this._hspace=this._hspace2=0;var tw=flowchart.context.measureText(this.text).width;if(tw>this._textwidth)this._textwidth=tw;var tw2=flowchart.context.measureText(this.text2).width;if(tw2>this._textwidth)this._textwidth=tw2;if(tw<this._textwidth)this._hspace=(this._textwidth-tw)/2;if(tw2<this._textwidth)this._hspace2=(this._textwidth-tw2)/2;this._textheight=FlowchartSetting.fontsize;this._textheight=FlowchartSetting.fontsize}else{this._textwidth=this.begin.textWidth;this._textheight=this.begin.textHeight}}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this.textHeight*(this.hasText?2:1)+size*2;this._width=this.textWidth+size*2;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;return this}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y1);flowchart.context.lineTo(this.x2,this.y2-size);flowchart.context.lineTo(this.x2-size,this.y2);flowchart.context.lineTo(this.x1+size,this.y2);flowchart.context.lineTo(this.x1,this.y2-size);flowchart.context.lineTo(this.x1,this.y1);flowchart.context.stroke();if(this.hasText){flowchart.context.fillText(this.text,this.x1+size+this.hspace,this.y1+size+this.textHeight);flowchart.context.fillText(this.text2,this.x1+size+this.hspace2,this.y1+size+this.textHeight*2)}if(position!=null){position.y=this.y2}return this}appendCode(code,indent){return code}editMe(){this.begin.editMe()}deleteMe(){this.begin.deleteMe()}cutMe(){this.begin.cutMe()}highlight(){this.paint_highlight();this.begin.paint_highlight()}unhighlight(){this.paint_unhighlight();this.begin.paint_unhighlight()}}var misc_menu_ja=[["《各種処理》","none","《各種処理》",[]],["何もしない","NopStatement","何もしない",[]],["描画領域開く","gOpenWindow","描画領域開く(\t,\t)",["幅","高さ"]],["描画領域閉じる","gCloseWindow","描画領域閉じる()",[]],["描画領域全消去","gClearWindow","描画領域全消去()",[]],["線色設定","gSetLineColor","線色設定(\t,\t,\t)",["赤","青","緑"]],["塗色設定","gSetFillColor","塗色設定(\t,\t,\t)",["赤","青","緑"]],["文字色設定","gSetTextColor","文字色設定(\t,\t,\t)",["赤","青","緑"]],["線太さ設定","gSetLineWidth","線太さ設定(\t)",["太さ"]],["文字サイズ設定","gSetFontSize","文字サイズ設定(\t)",["サイズ"]],["文字描画","gDrawText","文字描画(\t,\t,\t)",["文字列","x","y"]],["点描画","gDrawPoint","点描画(\t,\t,\t,\t)",["x","y"]],["線描画","gDrawLine","線描画(\t,\t,\t,\t)",["x1","y1","x2","y2"]],["矩形描画","gDrawBox","矩形描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["矩形塗描画","gFillBox","矩形塗描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["円描画","gDrawCircle","円描画(\t,\t,\t)",["x","y","半径"]],["円塗描画","gFillCircle","円塗描画(\t,\t,\t)",["x","y","半径"]],["楕円描画","gDrawCircle","楕円描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["楕円塗描画","gFillCircle","楕円塗描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["弧描画","gDrawArc","弧描画(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["弧塗描画","gFillArc","弧塗描画(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["棒グラフ描画","gBarplot","棒グラフ描画(\t,\t,\t)",["幅","高さ","配列"]],["線グラフ描画","gLineplot","線グラフ描画(\t,\t,\t)",["幅","高さ","配列"]],["グラフ描画","gDrawGraph","グラフ描画(\t,\t)",["レイアウト情報","値の配列"]],["グラフ消去","gClearGraph","グラフ消去()",[]],["putline","putline","putline(\t,\t)",["ファイル番号","文字列"]],["putstr","putstr","putstr(\t,\t)",["ファイル番号","文字列"]],["close","close","close(\t)",["ファイル番号"]],["待つ","sleep","\tミリ秒待つ",["ミリ秒数"]],["繰り返しを抜ける","break","繰り返しを抜ける",[]],["変数を確認する","dump","変数を確認する",[]],["一時停止する","PauseStatement","一時停止する",[]]],misc_menu_en=[["《各種処理》","none","《各種処理》",[]],["何もしない","NopStatement","何もしない",[]],["gOpenWindow","gOpenWindow","gOpenWindow(\t,\t)",["幅","高さ"]],["gCloseWindow","gCloseWindow","gCloseWindow()",[]],["gClearWindow","gClearWindow","gClearWindow()",[]],["gSetLineColor","gSetLineColor","gSetLineColor(\t,\t,\t)",["赤","青","緑"]],["gSetFillColor","gSetFillColor","gSetFillColor(\t,\t,\t)",["赤","青","緑"]],["gSetTextColor","gSetTextColor","gSetTextColor(\t,\t,\t)",["赤","青","緑"]],["gSetLineWidth","gSetLineWidth","gSetLineWidth(\t)",["太さ"]],["gSetFontSize","gSetFontSize","gSetFontSize(\t)",["サイズ"]],["gDrawText","gDrawText","gDrawText(\t,\t,\t)",["文字列","x","y"]],["gDrawPoint","gDrawPoint","gDrawPoint(\t,\t,\t,\t)",["x","y"]],["gDrawLine","gDrawLine","gDrawLine(\t,\t,\t,\t)",["x1","y1","x2","y2"]],["gDrawBox","gDrawBox","gDrawBox(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gFillBox","gFillBox","gFillBox(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gDrawCircle","gDrawCircle","gDrawCicle(\t,\t,\t)",["x","y","半径"]],["gFillCircle","gFillCircle","gFillCircle(\t,\t,\t)",["x","y","半径"]],["gDrawOval","gDrawCircle","gDrawOval(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gFillOval","gFillCircle","gFillOval(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gDrawArc","gDrawArc","gDrawArc(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["gFillArc","gFillArc","gFillArc(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["gBarplot","gBarplot","gBarplot(\t,\t,\t)",["幅","高さ","値"]],["gLineplot","gLineplot","gLineplot(\t,\t,\t)",["幅","高さ","値"]],["gDrawGraph","gDrawGraph","gDrawGraph(\t,\t)",["レイアウト情報","値の配列"]],["gClearGraph","gClearGraph","gClearGraph()",,[]],["putline","putline","putline(\t,\t)",["ファイル番号","文字列"]],["putstr","putstr","putstr(\t,\t)",["ファイル番号","文字列"]],["close","close","close(\t)",["ファイル番号"]],["待つ","sleep","\tミリ秒待つ",["ミリ秒数"]],["繰り返しを抜ける","break","繰り返しを抜ける",[]],["変数を確認する","dump","変数を確認する",[]],["一時停止する","PauseStatement","一時停止する",[]]];var misc_menu=setting.graphic_command==0?misc_menu_ja:misc_menu_en;class Parts_Misc extends Parts{constructor(){super();this.setValue("none",[])}setValue(identifier,values){this._identifier=identifier;this._values=[];for(var i=0;i<values.length;i++)this._values.push(values[i].argsPyPEN());for(var i=0;i<misc_menu.length;i++){if(this._identifier!=misc_menu[i][1])continue;this._command=misc_menu[i][0];var code=misc_menu[i][2];for(var j=0;j<this.values.length;j++)code=code.replace("\t",this.values[j]);this._text=code;break}}setValuebyText(identifier,values){this._identifier=identifier;this._values=[];for(var i=0;i<values.length;i++)this._values.push(values[i]);for(var i=0;i<misc_menu.length;i++){if(this._identifier!=misc_menu[i][1])continue;this._command=misc_menu[i][0];var code=misc_menu[i][2];for(var j=0;j<this.values.length;j++)code=code.replace("\t",this.values[j]);this._text=code;break}}get identifier(){return this._identifier}get values(){return this._values}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+size*2;this._width=this._textwidth+size*4;var x1=p0.x-this.width/2;var x2=p0.x+this.width/2;var y2=p0.y+this.height;if(x1<p1.x)p1.x=x1;if(x2>p2.x)p2.x=x2;if(y2>p2.y)p2.y=y2;p0.y=y2;if(this.next==null||this.isBlockEnd)return this;return this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(position!=null){this.x1=position.x-this.width/2;this.x2=position.x+this.width/2;this.y1=position.y;this.y2=this.y1+this.height}flowchart.context.beginPath();flowchart.context.moveTo(this.x1,this.y1);flowchart.context.lineTo(this.x2,this.y1);flowchart.context.lineTo(this.x2,this.y2);flowchart.context.lineTo(this.x1,this.y2);flowchart.context.lineTo(this.x1,this.y1);flowchart.context.stroke();flowchart.context.fillText(this.text,this.x1+size*2,this.y2-size);if(position!=null){position.y=this.y2;if(this.end.next!=null)return this.end.next.paint(position);return this.end}return this}static appendMe(bar){var parts=new Parts_Misc;bar.next=parts;parts.next=new Parts_Bar;return parts.next}appendCode(code,indent){code+=makeIndent(indent);code+=this.text+"\n";if(this.next!=null)return this.next.appendCode(code,indent);return code}editMe(){openModalWindowforMisc(this)}edited(identifier,values){if(values!=null){this.setValuebyText(identifier,values)}flowchart.paint();flowchart.flowchart2code()}}var modal_title,modal_subtitle,modal_values,modal_parts;function openModalWindow(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle;modal_values=values;modal_parts=parts;html+="<table>";for(var i=0;i<modal_subtitle.length;i++)html+="<tr><td>"+subtitle[i]+'</td><td><input type="text" '+'id="inputarea'+i+'" value="'+values[i].replace(/\"/g,"&quot;")+'" '+'onfocus="select();" '+'onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+="</table>";html+='<button type="button" onclick="closeModalWindow(true);">OK</button>';html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>';modal_parts.highlight();$("#input").html(html);$("#input").height(100+subtitle.length*30);$("#input-overlay").fadeIn();$("#input").fadeIn();$("#inputarea0").focus()}function openModalWindowforSubstitute(title,subtitle,values,parts){var operator=values[2]?values[2]:"（なし）";var operators=["（なし）","+","-","*","/","//","%","&","|","<<",">>"];var html="<p>"+title+"</p>";modal_subtitle=subtitle;modal_values=values;modal_parts=parts;html+="<table>";html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" '+'id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" '+'onfocus="select();" '+'onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+="<tr><td>"+subtitle[1]+'</td><td><input type="text" '+'id="inputarea1" value="'+values[1].replace(/\"/g,"&quot;")+'" '+'onfocus="select();" '+'onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+="<tr><td>"+subtitle[2]+'</td><td><select id="inputarea2">';for(var i=0;i<=operators.length;i++)html+='<option value="'+operators[i]+'"'+(operator==operators[i]?'selected="selected"':"")+">"+operators[i]+"</option>";html+="</td></tr>";html+="</table>";html+='<button type="button" onclick="closeModalWindow(true);">OK</button>';html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>';modal_parts.highlight();$("#input").html(html);$("#input").height(100+subtitle.length*40);$("#input-overlay").fadeIn();$("#input").fadeIn();$("#inputarea0").focus()}function openModalWindowforInput(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle;modal_values=values;modal_parts=parts;html+="<table>";html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" '+'id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" '+'onfocus="select();" '+'onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+="<tr><td>"+subtitle[1]+'</td><td><select id="inputarea1">';for(var i=typeOfValue.typeInt;i<=typeOfValue.typeBoolean;i++)html+='<option value="'+i+'"'+(i==values[1]?'selected="selected"':"")+">"+nameOfType[i]+"</option>";html+="</td></tr>";html+="</table>";html+='<button type="button" onclick="closeModalWindow(true);">OK</button>';html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>';modal_parts.highlight();$("#input").html(html);$("#input").height(100+subtitle.length*40);$("#input-overlay").fadeIn();$("#input").fadeIn();$("#inputarea0").focus()}function openModalWindowforOutput(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle;modal_values=values;modal_parts=parts;html+="<table>";html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" '+'id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" '+'onfocus="select();" '+'onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+='<tr><td></td><td><input type="checkbox" '+'id="inputarea1"'+(values[1]?' checked="checked"':"")+">改行する</td></tr>";html+="</table>";html+='<button type="button" onclick="closeModalWindow(true);">OK</button>';html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>';modal_parts.highlight();$("#input").html(html);$("#input").height(100+subtitle.length*40);$("#input-overlay").fadeIn();$("#input").fadeIn();$("#inputarea0").focus()}function closeModalWindow(ok){if(ok){for(var i=0;i<modal_subtitle.length;i++){var $j=$("#inputarea"+i);if($j.prop("type")=="checkbox")modal_values[i]=$j.prop("checked");else modal_values[i]=$j.val()}}$("#input").hide();$("#input-overlay").hide();modal_parts.unhighlight();if(ok)makeDirty(true);modal_parts.edited(ok?modal_values:null)}function keydownModal(e){var evt=e||window.event;if(evt.keyCode==27)closeModalWindow(false);else if(evt.keyCode==13){evt.preventDefault();closeModalWindow(true)}}var misc_identifier;function openModalWindowforMisc(parts){var html="<p>各種処理の編集</p>";modal_parts=parts;modal_values=[];for(var i=0;i<parts.values.length;i++)modal_values.push(parts.values[i]);html+='<select id="misccommands" onchange="onmiscchanged();">';for(var i=0;i<misc_menu.length;i++)html+='<option value="'+misc_menu[i][1]+'"'+(misc_menu[i][1]==parts.identifier?" selected":"")+">"+misc_menu[i][0]+"</option>";html+="</select>";html+='<table id="miscvalues">';html+="</table>";html+='<button type="button" onclick="closeModalWindowforMisc(true);">OK</button>';html+='<button type="button" onclick="closeModalWindowforMisc(false);">キャンセル</button>';modal_parts.highlight();$("#input").html(html);$("#input-overlay").fadeIn();$("#input").fadeIn();setIdentifierforMisc(parts.identifier)}function onmiscchanged(){var index=document.getElementById("misccommands").selectedIndex;setIdentifierforMisc(misc_menu[index][1])}function setIdentifierforMisc(identifier){misc_identifier=identifier;for(var i=0;i<modal_values.length;i++){var elem=document.getElementById("inputarea"+i);if(elem)modal_values[i]=elem.value;if(/《.*》/.test(modal_values[i]))modal_values[i]=null}var table=document.getElementById("miscvalues");while(table.firstChild)table.removeChild(table.firstChild);for(var i=0;i<misc_menu.length;i++){if(identifier!=misc_menu[i][1])continue;var tmp_values=[];for(var j=0;j<misc_menu[i][3].length;j++){var v="《"+misc_menu[i][3][j]+"》";if(modal_values.length>j&&modal_values[j]!=null)v=modal_values[j];else if(modal_parts.values.length>j&&modal_parts.values[j]!=null)v=modal_parts.values[j];tmp_values.push(v);var tr=document.createElement("tr");var td=document.createElement("td");td.innerHTML=misc_menu[i][3][j];tr.appendChild(td);td=document.createElement("td");var input=document.createElement("input");input.setAttribute("id","inputarea"+j);input.setAttribute("value",v);input.setAttribute("onfocus","select();");input.setAttribute("onkeydown","keydownModalforMisc(event);");input.setAttribute("spellcheck","false");td.appendChild(input);tr.appendChild(td);table.appendChild(tr)}modal_values=tmp_values}$("#input").height(120+modal_values.length*35)}function closeModalWindowforMisc(ok){if(ok){for(var i=0;i<modal_values.length;i++){modal_values[i]=document.getElementById("inputarea"+i).value}}$("#input").hide();$("#input-overlay").hide();modal_parts.unhighlight();modal_parts.edited(misc_identifier,ok?modal_values:null)}function keydownModalforMisc(e){var evt=e||window.event;if(evt.keyCode==27)closeModalWindowforMisc(false);else if(evt.keyCode==13)closeModalWindowforMisc(true)}"use strict";var debug_mode=false;const typeOfValue={typeInt:1,typeFloat:2,typeString:3,typeBoolean:4,typeArray:5,typeDictionary:6};const nameOfType=["","整数","実数","文字列","真偽","配列","辞書"];var code=null;var varTables=[];var myFuncs={};var run_flag=false,step_flag=false,editable_flag=true;var flowchart=null;var textarea=null;var context=null;var current_line=-1;var wait_time=0;var flowchart_display=false;var converting=false;var dirty=null;var timeouts=[];var selected_quiz=-1,selected_quiz_case=-1,selected_quiz_input=0,selected_quiz_output=0;var output_str="";var test_limit_time=0;var fontsize=16;var python_lib={};var editor=null;class parsedCode{constructor(statementlist){this.stack=[{statementlist:statementlist,index:0}]}argsPython(){python_lib={};var code=[];var libs="";for(var i=0;i<this.stack[0].statementlist.length;i++){var state=this.stack[0].statementlist[i];if(state&&state instanceof DefineFunction)code.push(state.argsPython(0)+"\n")}for(var i=0;i<this.stack[0].statementlist.length;i++){var state=this.stack[0].statementlist[i];if(state&&!(state instanceof DefineFunction))code.push(state.argsPython(0))}for(var lib in python_lib)libs+="import "+lib+"\n";return libs+code.join("\n")}}class parsedMainRoutine extends parsedCode{constructor(statementlist){super(statementlist)}}class parsedFunction extends parsedCode{constructor(statementlist){super(statementlist)}}class varTable{constructor(){this.vars={}}varnames(oldvars){var names=oldvars.concat();for(var name in this.vars)if(names.indexOf(name)<0)names.push(name);return names.sort()}}function findVarTable(varname){return varname in varTables[0].vars?varTables[0]:null}function codeChange(){if(converting||!flowchart_display)return;var code=editor.getDoc().getValue()+"\n";textareaClear();try{myFuncs={};var dncl_code=python_to_dncl(code);var parse=dncl.parse(dncl_code);var flag=false;for(var i=0;i<parse.length;i++)if(parse[i]instanceof DefineFunction)flag=true;if(flag){textareaAppend("関数定義のあるプログラムのフローチャートはまだ実装していません。\n");return}converting=true;flowchart.code2flowchart(parse);converting=false}catch(e){highlightLine(-1);textareaClear();if(e.line&&e.line>0)textareaAppend("***構文エラー***\n"+e.line+"行目\n");textareaAppend(e.message);if(debug_mode)textareaAppend(e.stack);converting=false}}function isFinite(v){return Number.isFinite(v)}function isSafeInteger(v){return Number.isSafeInteger(v)}function isInteger(v){return Number.isInteger(v)}function isPrimitive(v){if(v instanceof IntValue||v instanceof FloatValue||v instanceof StringValue||v instanceof BooleanValue||v instanceof NullValue)return true;else return false}function constructor_name(obj){if(obj)return obj.constructor.name;else return null}function toHalf(s,loc){s=s.toString();if(setting.zenkaku_mode==1&&/[Ａ-Ｚａ-ｚ０-９．−]/.exec(s))throw new RuntimeError(loc.first_line,"数値や変数名を全角文字で入力してはいけません");return s.replace(/[Ａ-Ｚａ-ｚ０-９．−]/g,function(s){return String.fromCharCode(s.charCodeAt(0)-65248)})}function makeDirty(b){if(b!==dirty){dirty=b;document.getElementById("dirty").style.visibility=dirty?"visible":"hidden"}}function textareaAppend(v){textarea.value+=v;textarea.scrollTop=textarea.scrollHeight}function textareaClear(){textarea.value=""}class Location{constructor(first_token,last_token){this.first_line=first_token.first_line;this.last_line=last_token.last_line}}class RuntimeError{constructor(line,message){if(selected_quiz<0)dump("*** 実行時エラー ***");this._line=line;this._message=message;setRunflag(false)}get line(){return this._line}get message(){return this._message}}function highlightLine(l){var scroll_elem=editor.getScrollerElement();var code_elems=scroll_elem.getElementsByClassName("CodeMirror-code");if(!code_elems)return;var code_elem=code_elems[0];var ln=1;for(var line_elem=code_elem.firstElementChild;line_elem;line_elem=line_elem.nextElementSibling){var number_elems=line_elem.getElementsByClassName("CodeMirror-linenumber");if(!number_elems)continue;var number_elem=number_elems[0];if(ln++==l){number_elem.style.background="red";number_elem.style.color="white"}else{number_elem.style.background="transparent";number_elem.style.color="#999"}}}function reset(b=true){varTables=[new varTable];myFuncs={};current_line=-1;if(b){textareaClear();highlightLine(-1);var canvas=document.getElementById("canvas");canvas.style.display="none";document.getElementById("input_status").style.visibility="hidden";context=null;Plotly.purge(document.getElementById("graph"))}setRunflag(false);code=null;var input_area=document.getElementById("input_area");input_area.readOnly=true;input_area.value="";wait_time=0;timeouts=[];selected_quiz_input=selected_quiz_output=0;output_str="";filesystem.all_close();filesystem.clear();storage_list_update()}function setRunflag(b){run_flag=b;document.getElementById("sourceTextarea").readOnly=b;editor.options.readOnly=b;if(b)editor.getWrapperElement().classList.add("readonly");else editor.getWrapperElement().classList.remove("readonly");document.getElementById("runButton").innerHTML=b&!step_flag?"中断":"実行";document.getElementById("dumpButton").disabled=!step_flag;setEditableflag(!b)}function setEditableflag(b){editable_flag=b;document.getElementById("drawButton").disabled=!b;document.getElementById("pythonButton").disabled=!b;document.getElementById("urlButton").disabled=!b}function run(clear=true){if(code==null){try{reset(clear);var pypen_source=editor.getDoc().getValue();var dncl_source=python_to_dncl(pypen_source);code=[new parsedMainRoutine(dncl.parse(dncl_source))]}catch(e){if(selected_quiz<0){textareaAppend("***構文エラー***\n");if(e.line)textareaAppend(e.line+"行目");textareaAppend(e.message+"\n");if(debug_mode)textareaAppend(e.stack);reset(false);return}else throw e}}setRunflag(true);step()}function wait(ms){let t1=Date.now();while(Date.now()-t1<ms);}function step(){if(selected_quiz<0){var l=current_line;do{next_line()}while(run_flag&&l==current_line);if(!code)return;if(code[0]&&code[0].stack.length>0){if(run_flag&&!step_flag){if(wait_time>0){wait(wait_time);wait_time=0}setZeroTimeout(step,0)}}else{textareaAppend("---\n");reset(false)}}else{do{next_line();if(Date.now()>test_limit_time)throw new RuntimeError(-1,"時間がかかりすぎです。")}while(run_flag&&code[0]&&code[0].stack.length>0)}}function next_line(){var index=code[0].stack[0].index;var statement=code[0].stack[0].statementlist[index];if(statement&&typeof statement.run==="function"){try{if(debug_mode){}statement.run()}catch(e){if(selected_quiz<0){if(e.line)textareaAppend(e.line+"行目:");if(e instanceof RuntimeError)textareaAppend(e.message+"\n");else if(e instanceof RangeError)textareaAppend("計算できない値があります。\n"+e.message+"\n");else textareaAppend("（おそらくPyPENのバグなので，コードを添えて開発者に連絡してください）\n"+e.message+"\n");if(debug_mode){textareaAppend(e.stack)}reset(false)}else throw e}}else if(statement){textareaAppend("内部エラー: 実行できない文があります。\n"+ +"Statement:"+constructor_name(statement)+"\n"+"Called by:"+constructor_name(code[0].stack[1].statementlist[code[0].stack[1].index])+" index:"+code[0].stack[1].index+"\n");if(debug_mode)code_dump();code[0].stack[0].index++}if(!code||!code[0])return;index=code[0].stack[0]?code[0].stack[0].index:-1;while(index<0||index>=code[0].stack[0].statementlist.length){code[0].stack.shift();while(code[0]&&code[0].stack.length<1)code.shift();if(code.length<1)break;index=code[0]&&code[0].stack[0]?code[0].stack[0].index:-1}if(selected_quiz<0){if(code[0]&&code[0].stack[0]){index=code[0].stack[0].index;statement=code[0].stack[0].statementlist[index];if(statement&&statement instanceof Statement){if(statement.loc)highlightLine(current_line=statement.first_line);if(statement instanceof PauseStatement){document.getElementById("runButton").innerHTML="実行";step_flag=true}}}else highlightLine(++current_line)}}function editButton(add_code){if(document.getElementById("sourceTextarea").readOnly){window.alert("プログラム実行・中断中はプログラムを編集できません");return}var pos=editor.getDoc().getCursor();var code=editor.getDoc().getValue();var lines=code.split(/\r|\n|\r\n/);var code1=lines[pos.line].slice(0,pos.ch);var code2=lines[pos.line].slice(pos.ch,code.length);var re1=/^[｜| 　]*$/;var add_codes=add_code.split("\n");var tab="";var array=re1.exec(code1);if(array)tab=array[0];if(code2){alert("カーソルの右側に文字や空白があるときに\n入力支援ボタンを押してはいけません");editor.focus();return}editor.replaceSelection(add_codes.join("\n"+tab));editor.setCursor({line:pos.line,ch:pos.ch,scroll:false});editor.focus()}function keyDown(e){var evt=e||window.event;var sourceTextArea=document.getElementById("sourceTextarea");var pos1=sourceTextArea.selectionStart;var pos2=sourceTextArea.selectionEnd;var code=sourceTextArea.value;var code1=code.slice(0,pos1);var code2=code.slice(pos1,pos2);var code3=code.slice(pos2,code.length);var re1=/^(    |　　|  　| 　 |　  )/;var re2=/(    |　　|  　| 　 |　  )$/;var tab="    ";switch(evt.keyCode){case 9:if(evt.shiftKey){if(re2.exec(code1))code1=code1.replace(re2,"");else if(pos1==pos2){if(re1.exec(code3))code3=code3.replace(re1,"")}else{code2=code2.replace(/([\n])(    |　　|  　| 　 |　  )/g,"$1").replace(/^(    |　　|  　| 　 |　  )/,"")}sourceTextArea.value=code1+code2+code3;sourceTextArea.setSelectionRange(code1.length,code1.length+code2.length)}else{if(pos1<pos2)code2=code2.replace(/\n([^$])/g,"\n    $1");sourceTextArea.value=code1+tab+code2+code3;var pos3=code1.length+tab.length,pos4=pos3;if(pos1<pos2){pos4=pos3+code2.length;pos3-=tab.length}sourceTextArea.setSelectionRange(pos3,pos4)}evt.preventDefault();return false;case 8:if(re2.exec(code1))code1=code1.replace(re2,"");else code1=code1.slice(0,-1);sourceTextArea.value=code1+code3;sourceTextArea.setSelectionRange(code1.length,code1.length);evt.preventDefault();return false;default:break}return true}function keyUp(e){var evt=e||window.event;switch(evt.keyCode){case 37:case 38:case 39:case 40:var pos=editor.getDoc().getCursor();var lines=editor.getDoc().getValue().split(/\r|\n|\r\n/);var line1=lines[pos.line].slice(0,pos.ch);var line2=lines[pos.line].slice(pos.ch);var re1=/《[^》《]*$/;var re2=/^[^》《]*》/;var match1=re1.exec(line1);var match2=re2.exec(line2);if(match1&&match2){var start=pos.ch-match1[0].length;var end=pos.ch+match2[0].length;editor.getDoc().setSelection({line:pos.line,ch:end},{line:pos.line,ch:start})}}}function mouseClick(evt){var pos=editor.coordsChar({left:evt.x,top:evt.y});var lines=editor.getValue().split(/\r|\n|\r\n/);var line1=lines[pos.line].slice(0,pos.ch);var line2=lines[pos.line].slice(pos.ch-1);var re1=/《[^》《]*$/;var re2=/^[^》《]*》/;var match1=re1.exec(line1);var match2=re2.exec(line2);if(match1&&match2){var start=pos.ch-match1[0].length;var end=pos.ch+match2[0].length-1;editor.getDoc().setSelection({line:pos.line,ch:end},{line:pos.line,ch:start})}}function sampleButton(num){if(dirty&&!window.confirm("プログラムをサンプルプログラムに変更していいですか？"))return;editor.getDoc().setValue(sample[num]);reset(true);if(flowchart)codeChange();editor.refresh();editor.focus();makeDirty(false)}function insertCode(add_code){if(document.getElementById("sourceTextarea").readOnly){window.alert("プログラム実行・中断中はプログラムを編集できません");return}var pos=editor.getDoc().getCursor();editor.getDoc().replaceSelection(add_code);editor.getDoc().setCursor({line:pos.line,ch:pos.ch});editor.focus()}function registerEvent(elem,ev,func){if(elem.addEventListener)elem.addEventListener(ev,func);else if(elem.attachEvent)elem.attachEvent("on"+ev,func)}function cmBackspace(cm){var pos=cm.getCursor();var code=cm.getValue();var lines=code.split(/\r|\n|\r\n/);var code1=lines[pos.line].slice(0,pos.ch);if(/^\s+$/.exec(code1))cm.execCommand("indentLess");else cm.execCommand("delCharBefore")}function cmCtrlRight(cm){var pos=cm.getCursor();var code=cm.getValue();var lines=code.split(/\r|\n|\r\n/);var selected=cm.getSelection();var ch=pos.ch;if(selected)ch+=selected.length;var code2=lines[pos.line].slice(ch);var find=/《[^《]*》/.exec(code2);if(find){var ch1=ch+find.index;var ch2=ch1+find[0].length;cm.setSelection({line:pos.line,ch:ch2},{line:pos.line,ch:ch1})}else cm.execCommand("goLineEnd")}function cmCtrlLeft(cm){var pos=cm.getCursor();var code=cm.getValue();var lines=code.split(/\r|\n|\r\n/);var code1=lines[pos.line].slice(0,pos.ch);var re1=new RegExp("《[^《]*》","g");var find=re1.exec(code1);if(find){do{var ch1=find.index;var ch2=ch1+find[0].length;find=re1.exec(code1)}while(re1.lastIndex>0);cm.setSelection({line:pos.line,ch:ch2},{line:pos.line,ch:ch1})}else if(/^\s*$/.exec(code1))cm.execCommand("goLineStart");else cm.execCommand("goLineStartSmart")}onload=function(){var code=getParam("code");if(code){editor.getDoc().setValue(code);codeChange();highlightLine(-1);editor.getDoc().setCursor({line:0,ch:0});makeDirty(false)}editor.refresh();editor.focus();storage_list_update()};function getParam(name){var getparam=window.location.search;if(getparam){var params=getparam.slice(1).split("&");for(var param of params){var p=param.split("=");if(p[0]==name){return B64decode(p[1])}}}return null}function auto_marking(i){reset(true);setRunflag(true);setEditableflag(false);textareaClear();textareaAppend("*** 採点開始 ***\n");selected_quiz=i;let all_clear=true;for(let j=0;j<Quizzes[i].cases();j++){let clear=true;textareaAppend("ケース"+(j+1)+"...");try{selected_quiz_case=j;test_limit_time=Date.now()+Quizzes[selected_quiz].timeout();run(false);if(selected_quiz_input!=Quizzes[selected_quiz].inputs(selected_quiz_case).length)throw new RuntimeError(-1,"入力の回数がおかしいです。");else if(output_str.trim()!=Quizzes[selected_quiz].output(selected_quiz_case).toString().trim())throw new RuntimeError(-1,"結果が違います。");textareaAppend("成功\n")}catch(e){textareaAppend("失敗\n");textareaAppend(e.message+"\n");clear=false}all_clear&=clear;reset(false)}if(all_clear)textareaAppend("*** 合格 ***\n");else textareaAppend("--- 不合格 ---\n");selected_quiz=-1;document.getElementById("runButton").disabled=false;document.getElementById("stepButton").disabled=false;document.getElementById("stepdumpButton").disabled=false;document.getElementById("resetButton").disabled=false;document.getElementById("urlButton").disabled=false;setRunflag(false)}function font_size(updown){if(updown!=0){if(fontsize+updown<14||fontsize+updown>30)return;fontsize+=updown}else fontsize=16;var elem=document.getElementById("CMSourceTextArea");elem.style.fontSize=fontsize+"px";elem=document.getElementsByClassName("CodeMirror-cursor")[0];elem.style.fontSize=fontsize+"px";editor.refresh();elem=textarea;elem.style.fontSize=fontsize+"px";editor.focus()}function makeIndent(indent_level){return"    ".repeat(indent_level)}function makePython(){if(run_flag)return;code=null;myFuncs={};python_lib={};try{var code=editor.getDoc().getValue();var dncl_code=python_to_dncl(code);var main_routine=new parsedMainRoutine(dncl.parse(dncl_code));var python_code=main_routine.argsPython(0);textareaClear();textareaAppend(python_code)}catch(e){highlightLine(-1);textareaClear();if(e.line&&e.line>0)textareaAppend("***構文エラー***\n"+e.line+"行目\n");textareaAppend(e.message);if(debug_mode)textareaAppend(e.stack)}}function code_dump(){let str="";for(let i=0;i<code.length;i++){str+="code["+i+"]\n";for(let j=0;j<code[i].stack.length;j++){let statement=[];for(let k=0;k<code[i].stack[j].statementlist.length;k++){if(code[i].stack[j].statementlist[k])statement.push("  "+constructor_name(code[i].stack[j].statementlist[k])+"("+code[i].stack[j].statementlist[k].state+")");if(constructor_name(code[i].stack[j].statementlist[k])=="Assign"){statement.push("   varname: "+code[i].stack[j].statementlist[k].variable.varname);statement.push("   value: "+array2code(code[i].stack[j].statementlist[k].value,true))}}str+=" stack["+j+"]["+code[i].stack[j].index+"]"+statement.join("\n")+"\n"}}textareaAppend(str)}function var_dump(vn){let str="";let vt=varTables[0];let varobj=vt.vars[vn];if(!varobj){textareaAppend("変数 "+vn+" は見つかりません\n");return}str+="変数 "+vn+"\n";str+=" type: "+constructor_name(varobj)+"\n";str+=" value: "+varobj.value+"\n";str+=" rtnv: "+varobj.rtnv.value+"\n";textareaAppend(str)}var sourceTextArea=document.getElementById("sourceTextarea");var resultTextArea=document.getElementById("resultTextarea");var newButton=document.getElementById("newButton");var runButton=document.getElementById("runButton");var flowchartButton=document.getElementById("flowchartButton");var resetButton=document.getElementById("resetButton");var stepButton=document.getElementById("stepButton");var stepdumpButton=document.getElementById("stepdumpButton");var dumpButton=document.getElementById("dumpButton");var loadButton=document.getElementById("loadButton");var file_prefix=document.getElementById("file_prefix");var flowchart_canvas=document.getElementById("flowchart");editor=CodeMirror.fromTextArea(sourceTextArea,{mode:{name:"pypen"},lineNumbers:true,lineWrapping:true,indentUnit:4,indentWithTabs:false,extraKeys:{Tab:"indentMore","Shift-Tab":"indentLess",Backspace:cmBackspace,"Ctrl-Left":cmCtrlLeft,"Ctrl-Right":cmCtrlRight}});editor.setSize(500,300);editor.on("change",function(){editor.save();makeDirty(true)});resultTextArea.style.width=document.getElementById("input_area").clientWidth+"px";new ResizeObserver(function(){var w=editor.getWrapperElement().width;var h=resultTextArea.offsetHeight-4;editor.setSize(w,h);editor.refresh()}).observe(resultTextArea);editor.getWrapperElement().id="CMSourceTextArea";editor.getWrapperElement().addEventListener("mousedown",mouseClick);editor.getWrapperElement().addEventListener("keyup",keyUp);sourceTextArea.onchange=function(){makeDirty(true)};makeDirty(false);textarea=resultTextArea;runButton.onclick=function(){if(run_flag&&!step_flag){setRunflag(false);document.getElementById("sourceTextarea").readOnly=true;editor.options.readOnly=true;editor.getWrapperElement().classList.add("readonly");dumpButton.disabled=false}else{step_flag=false;dumpButton.disabled=true;run()}};stepButton.onclick=function(){step_flag=true;run()};stepdumpButton.onclick=function(){step_flag=true;run();if(run_flag)dump()};newButton.onclick=function(){if(dirty&&!window.confirm("プログラムを削除していいですか？"))return;editor.getDoc().setValue("");code=null;reset(true);if(flowchart){flowchart.makeEmpty();flowchart.paint()}editor.focus();makeDirty(false)};resetButton.onclick=function(){reset(true)};dumpButton.onclick=function(){dump()};document.getElementById("loadButton1").onclick=function(ev){loadButton.click();return false};loadButton.addEventListener("change",function(ev){var file=ev.target.files;var reader=new FileReader;reader.readAsText(file[0],"UTF-8");reader.onload=function(ev){editor.setValue(reader.result);reset(true);if(flowchart)codeChange()}},false);downloadLink.onclick=function(){var filename=file_prefix.value.trim();if(filename.length<1){alert("ファイル名を入力しないと保存できません");return false}filename+=".PyPEN";var blob=new Blob([editor.getDoc().getValue()],{type:"text/plain"});if(window.navigator.msSaveBlob){window.navigator.msSaveBlob(blob,filename)}else{window.URL=window.URL||window.webkitURL;downloadLink.setAttribute("href",window.URL.createObjectURL(blob));downloadLink.setAttribute("download",filename)}makeDirty(false)};flowchartButton.onchange=function(){flowchart_display=this.checked;var flowchart_area=document.getElementById("Flowchart_area");var drawButton=document.getElementById("drawButton");if(flowchart_display){flowchart_area.style.display="block";drawButton.style.display="inline";flowchart=new Flowchart;codeChange()}else{flowchart_area.style.display="none";drawButton.style.display="none";flowchart=null}};if(setting.flowchart_mode)flowchartButton.click();editor.getWrapperElement().ondrop=function(e){var filelist=e.dataTransfer.files;if(!filelist)return;for(var i=0;i<filelist.length;i++){if(!/\.PyPEN$/i.exec(filelist[i].name))continue;if(window.FileReader){try{var reader=new FileReader;reader.readAsText(filelist[i]);reader.onload=function(event){editor.getDoc().setValue(event.target.result);codeChange()};break}catch(e){}}}return false};registerEvent(flowchart_canvas,"mousedown",mouseDown);registerEvent(flowchart_canvas,"mouseup",mouseUp);registerEvent(flowchart_canvas,"mousemove",mouseMove);registerEvent(flowchart_canvas,"dblclick",doubleclick_Flowchart);$.contextMenu({selector:"#CMSourceTextArea",zIndex:10,items:{zenkaku:{name:"入力補助",items:{"の中に":{name:"の中に",callback:function(k,e){insertCode("《配列》の中に《値》")}},"個の":{name:"個の",callback:function(k,e){insertCode("《整数》個の《値》")}},"と":{name:"と",callback:function(k,e){insertCode("《値》と《値》")}}}},convert:{name:"変換",items:{int:{name:"整数",callback:function(k,e){insertCode("整数(《値》)")}},float:{name:"実数",callback:function(k,e){insertCode("実数(《値》)")}},string:{name:"文字列",callback:function(k,e){insertCode("文字列(《値》)")}},bool:{name:"真偽",callback:function(k,e){insertCode("真偽(《値》)")}}}},math:{name:"数学関数",items:{abs:{name:"abs 絶対値",callback:function(k,e){insertCode("abs(《値》)")}},random1:{name:"random 乱数（整数）",callback:function(k,e){insertCode("random(《整数》)")}},random2:{name:"random 乱数（0〜1）",callback:function(k,e){insertCode("random()")}},ceil:{name:"ceil 切り上げ",callback:function(k,e){insertCode("ceil(《実数》)")}},floor:{name:"floor 切り捨て",callback:function(k,e){insertCode("floor(《実数》)")}},round:{name:"round 四捨五入",callback:function(k,e){insertCode("round(《実数》)")}},sin:{name:"sin サイン",callback:function(k,e){insertCode("sin(《実数》)")}},cos:{name:"cos コサイン",callback:function(k,e){insertCode("cos(《実数》)")}},tan:{name:"tan タンジェント",callback:function(k,e){insertCode("tan(《実数》)")}},sqrt:{name:"sqrt ルート",callback:function(k,e){insertCode("sqrt(《実数》)")}},log:{name:"log 自然対数",callback:function(k,e){insertCode("log(《実数》)")}},exp:{name:"exp 指数関数",callback:function(k,e){insertCode("exp(《実数》)")}},pow:{name:"pow 累乗",callback:function(k,e){insertCode("pow(《実数》,《実数》)")}}}},str:{name:"文字列関数",items:{length:{name:"length 長さ",callback:function(k,e){insertCode("length(《文字列》)")}},append:{name:"append 文字列結合",callback:function(k,e){insertCode("append(《文字列》,《文字列》)")}},substring1:{name:"substring 部分文字列（最後まで）",callback:function(k,e){insertCode("substring(《文字列》,《開始位置》)")}},substring2:{name:"substring 部分文字列（長さ指定）",callback:function(k,e){insertCode("substring(《文字列》,《開始位置》,《長さ》)")}},split:{name:"split 文字列分割",callback:function(k,e){insertCode("split(《文字列》,《区切文字列》)")}},extract:{name:"extract 文字列分割（番号指定）",callback:function(k,e){insertCode("extract(《文字列》,《区切文字列》,《番号》)")}},insert:{name:"insert 挿入",callback:function(k,e){insertCode("insert(《文字列》,《位置》,《文字列》)")}},replace:{name:"replace 置換",callback:function(k,e){insertCode("replace(《文字列》,《位置》,《長さ》,《文字列》)")}}}},fileio:{name:"File I/O",items:{openr:{name:"openr 読込用オープン",callback:function(k,e){insertCode("openr(《ファイル名》)")}},openw:{name:"openw 書込用オープン",callback:function(k,e){insertCode("openw(《ファイル名》)")}},opena:{name:"opena 追記用オープン",callback:function(k,e){insertCode("opena(《ファイル名》)")}},getline:{name:"getline",callback:function(k,e){insertCode("getline(《ファイル番号》)")}},getchar:{name:"getchar",callback:function(k,e){insertCode("getchar(《ファイル番号》)")}},putline:{name:"putline",callback:function(k,e){insertCode("putline(《ファイル番号》,《文字列》)")}},putstr:{name:"putstr",callback:function(k,e){insertCode("putstr(《ファイル番号》,《文字列》)")}}}},graphic1:{name:"グラフィック命令（日本語）",items:{gOpenWindow:{name:"描画領域開く",callback:function(k,e){insertCode("描画領域開く(《幅》,《高さ》)")}},gCloseWindow:{name:"描画領域閉じる",callback:function(k,e){insertCode("描画領域閉じる()")}},gClearWindow:{name:"描画領域全消去",callback:function(k,e){insertCode("描画領域全消去()")}},gSetLineColor:{name:"線色設定",callback:function(k,e){insertCode("線色設定(《赤》,《緑》,《青》)")}},gSetFillColor:{name:"塗色設定",callback:function(k,e){insertCode("塗色設定(《赤》,《緑》,《青》)")}},gSetTextColor:{name:"文字色設定",callback:function(k,e){insertCode("文字色設定(《赤》,《緑》,《青》)")}},gSetLineWidth:{name:"線太さ設定",callback:function(k,e){insertCode("線太さ設定(《太さ》)")}},gSetFontSize:{name:"文字サイズ設定",callback:function(k,e){insertCode("文字サイズ設定(《サイズ》)")}},gDrawText:{name:"文字描画",callback:function(k,e){insertCode("文字描画(《文字列》,《x》,《y》)")}},gDrawPoint:{name:"点描画",callback:function(k,e){insertCode("点描画(《x》,《y》)")}},gDrawLine:{name:"線描画",callback:function(k,e){insertCode("線描画(《x1》,《y1》,《x2》,《y2》)")}},gDrawBox:{name:"矩形描画",callback:function(k,e){insertCode("矩形描画(《x》,《y》,《幅》,《高さ》)")}},gFillBox:{name:"矩形塗描画",callback:function(k,e){insertCode("矩形塗描画(《x》,《y》,《幅》,《高さ》)")}},gDrawCircle:{name:"円描画",callback:function(k,e){insertCode("円描画(《x》,《y》,《半径》)")}},gFillCircle:{name:"円塗描画",callback:function(k,e){insertCode("円塗描画(《x》,《y》,《半径》)")}},gDrawOval:{name:"楕円描画",callback:function(k,e){insertCode("楕円描画(《x》,《y》,《幅》,《高さ》)")}},gFillOval:{name:"楕円塗描画",callback:function(k,e){insertCode("楕円塗描画(《x》,《y》,《幅》,《高さ》)")}},gDrawArc:{name:"弧描画",callback:function(k,e){insertCode("弧描画(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gFillArc:{name:"弧塗描画",callback:function(k,e){insertCode("弧塗描画(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gBarplot:{name:"棒グラフ描画",callback:function(k,e){insertCode("棒グラフ描画(《幅》,《高さ》,《値》)")}},gLineplot:{name:"線グラフ描画",callback:function(k,e){insertCode("線グラフ描画(《幅》,《高さ》,《値》)")}},gDrawGraph:{name:"グラフ描画",callback:function(k,e){insertCode("グラフ描画(《レイアウト情報》,《値の配列》)")}},gClearGraph:{name:"グラフ消去",callback:function(k,e){insertCode("グラフ消去()")}}}},graphic2:{name:"グラフィック命令（英語）",items:{gOpenWindow:{name:"gOpenWindow",callback:function(k,e){insertCode("gOpenWindow(《幅》,《高さ》)")}},gCloseWindow:{name:"gCloseWindow",callback:function(k,e){insertCode("gCloseWindow()")}},gClearWindow:{name:"gClearWindow",callback:function(k,e){insertCode("gClearWindow()")}},gSetLineColor:{name:"gSetLineColor",callback:function(k,e){insertCode("gSetLineColor(《赤》,《緑》,《青》)")}},gSetFillColor:{name:"gSetFillColor",callback:function(k,e){insertCode("gSetFillColor(《赤》,《緑》,《青》)")}},gSetTextColor:{name:"gSetTextColor",callback:function(k,e){insertCode("gSetTextColor(《赤》,《緑》,《青》)")}},gSetLineWidth:{name:"gSetLineWidth",callback:function(k,e){insertCode("gSetLineWidth(《太さ》)")}},gSetFontSize:{name:"gSetFontSize",callback:function(k,e){insertCode("gSetFontSize(《サイズ》)")}},gDrawText:{name:"gDrawText",callback:function(k,e){insertCode("gDraeText(《文字列》,《x》,《y》)")}},gDrawPoint:{name:"gDrawPoint",callback:function(k,e){insertCode("gDrawPoint(《x》,《y》)")}},gDrawLine:{name:"gDrawLine",callback:function(k,e){insertCode("gDrawLine(《x1》,《y1》,《x2》,《y2》)")}},gDrawBox:{name:"gDrawBox",callback:function(k,e){insertCode("gDrawBox(《x》,《y》,《幅》,《高さ》)")}},gFillBox:{name:"gFillBox",callback:function(k,e){insertCode("gFillBox(《x》,《y》,《幅》,《高さ》)")}},gDrawCircle:{name:"gDrawCircle",callback:function(k,e){insertCode("gDrawCircle(《x》,《y》,《半径》)")}},gFillCircle:{name:"gFillCircle",callback:function(k,e){insertCode("gFillCircle(《x》,《y》,《半径》)")}},gDrawOval:{name:"gDrawOval",callback:function(k,e){insertCode("gDrawOval(《x》,《y》,《幅》,《高さ》)")}},gFillOval:{name:"gFillOval",callback:function(k,e){insertCode("gFillOval(《x》,《y》,《幅》,《高さ》)")}},gDrawArc:{name:"gDrawArc",callback:function(k,e){insertCode("gDrawArc(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gFillArc:{name:"gFillArc",callback:function(k,e){insertCode("gFillArc(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gBarplot:{name:"gBarplot",callback:function(k,e){insertCode("gBarplot(《幅》,《高さ》,《値》)")}},gLineplot:{name:"gLineplot",callback:function(k,e){insertCode("gLineplot(《幅》,《高さ》,《値》)")}},gDrawGraph:{name:"gDrawGraph",callback:function(k,e){insertCode("gDrawGraph(《レイアウト情報》,《値の配列》)")}},gClearGraph:{name:"gClearGraph",callback:function(k,e){insertCode("gClearGraph()")}}}},misc:{name:"各種命令",items:{nop:{name:"何もしない",callback:function(k,e){insertCode("何もしない")}},sleep:{name:"待つ",callback:function(k,e){insertCode("《ミリ秒数》ミリ秒待つ")}},dump:{name:"変数を確認する",callback:function(k,e){insertCode("変数を確認する")}},pause:{name:"一時停止する",callback:function(k,e){insertCode("一時停止する")}}}}}});$.contextMenu({selector:"#flowchart",build:contextMenu_Flowchart});var messageName="zero-timeout-message";function setZeroTimeout(fn){timeouts.push(fn);window.postMessage(messageName,"*")}function handleMessage(event){if(event.source==window&&event.data==messageName){event.stopPropagation();if(timeouts.length>0){var fn=timeouts.shift();fn()}}}if(window.addEventListener)window.addEventListener("message",handleMessage,true);else if(window.attachEvent)window.attachEvent("onmessage",handleMessage);window.setZeroTimeout=setZeroTimeout;$(window).bind("beforeunload",function(){if(dirty)return"プログラムが消去されます"});reset(true);let sample_area=document.getElementById("SampleButtons");if(sample_load){let sample_table=document.createElement("table");sample_area.appendChild(sample_table);let sample_table_row=null;for(let i=0;i<sample.length;i++){if(!sample_table_row){sample_table_row=document.createElement("tr");sample_table.appendChild(sample_table_row)}let cell=document.createElement("td");let button=document.createElement("button");button.innerText="サンプル"+(i+1);button.setAttribute("type","button");button.setAttribute("class","sampleButton");button.onclick=function(){sampleButton(i)};cell.appendChild(button);sample_table_row.appendChild(cell);if(i%8==7)sample_table_row=null}}else sample_area.style.display="none";if(answer_load&&setting.quiz_mode==1&&Quizzes.length>0){let quiz_select=document.getElementById("quiz_select");quiz_select.onchange=function(){let i=quiz_select.selectedIndex;if(i>0)document.getElementById("quiz_question").innerHTML=Quizzes[i-1].question();else document.getElementById("quiz_question").innerHTML=""};let option=document.createElement("option");option.val=0;option.appendChild(document.createTextNode("問題選択"));quiz_select.appendChild(option);for(let i=0;i<Quizzes.length;i++){option=document.createElement("option");option.val=i+1;option.appendChild(document.createTextNode("Q"+(i+1)+":"+Quizzes[i].title()));quiz_select.appendChild(option)}document.getElementById("quiz_marking").onclick=function(){let i=quiz_select.selectedIndex;if(i>0)auto_marking(i-1);else{textareaClear();textareaAppend("問題が選択されていないので採点できません。")}}}else{document.getElementById("Quiz_area").style.display="none"}document.getElementById("urlButton").onclick=function(){var code=sourceTextArea.value.trim();if(code=="")return;code=B64encode(code);if(code){var url=window.location;textareaClear();highlightLine(-1);textareaAppend(url.protocol+"//"+url.hostname+url.pathname+"?code="+code)}};